
data_4000::
    db $42, $C2, $D2, $C2, $C2, $D2, $C2, $C2, $C3, $12, $42, $12, $42, $12, $12, $92
    db $12, $18, $12, $11, $12, 2, 2, 2, $12, 2, $12, $12, $11, 2, $12, $12
    db $12, 2, $42, $92, $12, $E2, $E2, 2, $12, 2, 2, $41, $12, $B1, $B1, $B1
    db $B1, $B1, $B2, $B2, $B1, $B2, $B2, $B2, $B1, $92, $B2, $B1, $B2, $B1, $82, $92
    db $84, $92, $82, $C0, $C0, $C2, $82, $82, $82, $82, $F2, $82, $41, $82, $82, $82
    db $12, 2, $42, $42, $C2, 2, 2, 2, $42, 8, $48, 0, $91, 2, 0, 0
    db 2, $C2, 8, 2, $C0, 0, $82, 2, $C0, $C2, $92, $82, $92, $12, $C1, $92
    db $92, $92, $92, $92, $93, $92, $92, $92, $92, $92, $52, $92, 0, $42, 2, $82
    db $92, 0, $42, $C2, $D1, $D2, $D1, $12, $84, $C, $C2, $C2, $92, $92, 8, $12
    db $12, $13, $14, $12, $80, $92, $92, $C0, $D2, $12, $C0, $D2, $12, $94, $C0, $12
    db $12, $12, $14, $C4, $C4, $C4, $C2, $8A, $D2, 2, $12, $12, $12, $92, $12, $B2
    db 2, $82, $C0, $82, $92, $82, $92, $94, $95, $12, $13, $12, $12, $13, $16, $52
    db $C0, $D2, $D2, $94, $98, $12, $12, $D0, $D2, $C1, $88, 2, $52, $85, $84, $C2
    db $82, $82, $82, $D2, $D2, $D2, $82, 2, $C2, $C8, $42, $48, $C4, $C2, $C2, $C2
    db $D3, $D2, $42, $12, $13, $D2, $50, $C0, 0, $13, $13, $13, $74, $74, $74, $82
    db $82, $82, $94, $94, $C, $C2, $82, $82, 6, $C, $83

data_C0FB::      db 0, 0, 1, 1, 1, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, $80
                 db 0, 8, 0, 1, 0, 0, 3, 3, 0, 0, 0, 0, $10, 2, 0, 0
                 db 0, 0, 0, 0, 0, $80, $80, $82, 0, 0, $80, 0, $80, $1D, $1D, $1D
                 db $1D, $1D, 1, $1D, $1D, $1D, $1D, $1D, $1D, $9D, $1D, $1D, $1D, $1D, $98, $98
                 db $98, $98, $98, $98, $98, 0, $84, $84, $84, $84, $80, $98, 0, $98, $98, $98
                 db 0, 0, 0, 0, $80, 0, 0, 0, 0, $88, 8, 0, $80, $80, $80, $A8
                 db $80, 0, 0, 0, 0, 0, 0, $80, 0, 0, $80, $98, 0, $80, 0, 0
                 db $98, $98, $98, $98, $98, $98, $98, $98, $80, $98, 0, $98, 8, $10, 0, $80
                 db $98, 0, $20, 0, 0, 0, $38, 0, $88, 8, 4, 4, $84, $84, $88, 0
                 db 0, 0, $80, 0, 0, $80, $80, 0, 0, 0, 0, 0, 0, $A4, 0, 0
                 db 0, 0, 0, $2C, $2C, $2C, $30, $A4, $80, 0, 0, 0, 0, $80, 0, $1D
                 db 0, $98, 0, $98, $98, $B4, $98, $98, $98, 0, 0, 0, 0, 0, $80, 0
                 db 0, $18, $18, $B4, $B4, 6, 0, $34, $98, 0, $80, 0, 0, $98, $98, 0
                 db $98, $98, $98, $98, 0, $18, $BD, $80, $2D, $2D, 0, $A, 0, 0, 0, 0
                 db 0, 0, 0, 0, $84, $38, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                 db 0, 0, 0, 0, 8, 0, 0, 0, 8, 8, $98

data_C1F6::      db 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, $D, 1, $D, 1, 1, 8
                 db $13, $13, $13, 0, 1, 6, $2C, $2C, $C, 0, $2A, 0, 0, 0, $2A, $2F
                 db $B, $C, $E, 1, 1, 6, 6, 9, 4, 1, 0, $E, 1, 0, 0, 0
                 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, $E, 0, 0, 0
                 db $20, $13, 0, 0, 0, $B, $B, $30, $E, $18, $1D, $1A, $19, $1C, $10, $11
                 db $12, 0, $1F, $1E, 0, $1B, $22, 0, 0, 0, 0, 0, 0, 0, 0, 0
                 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, $21, 0, $29, 0, $29, 0
                 db 0, $13, 0, 0, 0, 0, 0, $13, $15, $14, 1, 1, 1, 1, $13, $24
                 db $2D, $2E, $13, $25, $23, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                 db 2, 0, 0, 0, 0, 0, 0, 0, 0, $F, $2B, 0, 0, 0, $13, 0
                 db 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0
                 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                 db 0, 0, $28, 0, $13, 0, $26, 0, 0, $31, $31, $31, 0, 0, 0, $22
                 db $22, $22, $2B, 0, $14, 0, $22, $22, $33, $14, 0


data_C2F1::     db $12, $12, $A, $12, $12, $A, 2, 2, 2, 8, $12, 8, $12, 8, 0, $40
                db $11, $11, $11, 0, 8, $12, $12, $12, 8, $11, 8, 8, 8, $10, 8, 8
                db 8, 8, $12, 8, 8, 8, 8, $52, 8, 8, $A, $12, 8, $A, $A, $13
                db $A, $A, $A, $A, $A, $A, 8, $A, $A, 8, $A, $A, $1B, $1A, 2, 2
                db 2, 2, 2, 2, 2, $42, 2, 2, 2, 2, $42, 2, $12, 0, 2
data_C340::     db 2, $30, 8, 2, 2, 2, 8, 8, 8, $12, $D0, $90, $90, $D0, $90, $D4

data_C350::      db $84, $D4, 2, $D0, $90, 2, $80, 2, $42, $12, 2, 2, 2, 2, $43, 0

data_C360::      db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, $20, 0, 2, 2, 2
                 db $40, 0, $84, $40, 0, 0, 0, 2, $84, $C4, $94, 0, 0, 0, 0, $84
                 db 0, 0, 0, $C4, $10, 0, 0, 0, 0, 0, $10, 0, 0, 0, $42, 2
                 db 0, 0, 0, 0, 2, 2, 2, 2, $42, $42, 0, $10, $10, 8, $18, 0

data_C3A0::      db $13, 0, $12, 0, 2, 2, 2, 2, 2, 2, 0, 1, 0, $84, $11, $84
                 db 0, 0, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2
                 db 2, 0, 0, 0, 0, 0, 3, 2, $42, $42, 2, 2, 2, 2, 2, 2
                 db $12, 2, 2, 2, 2, 0, 2, 0, 2, 2, 0, 0, 0, 0, 0, 0

data_C3E0::     db 0, 0, 0, 4, 4, $94, $42, 0, 0, $94, $90, $12

data_C3EC::     db 1, 1, 1, 0, 0, 1, 2, 1, 2, 3, 3, 2, 0, 0, 0, 0
                db 1, 1, 1, 0, 0, 2, 2, 2, 2, 3, 3, 2, 0, 0, 0, 0
                db 1, 1, 1, 0, 0, 2, 2, 2, 2, 1, 3, 2, 0, 0, 0, 0
                db 1, 1, 1, 0, 0, 2, 1, 2, 1, 1, 3, 2, 0, 0, 0, 0
                db 0, 3, 3, 0

data_C430::      db 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 3, 0
                 db 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0
                 db 0, 0, 0, 0, 2, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0

data_C460::      db 0, 1, 3, 1, 2, 3, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0
                 db 0, 3, 1, 2, 4, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0

data_C480::     db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                db 0, 0, 1, 1, 1, 1, 3, 1, 0, 0, 0, 0, 0, 0, 0, 0
data_C4A0::     db 0, 0, 1, 3, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                db 0, 1, 1, 3, 1, 1, 1, 3, 0, 0, 0, 0, 0, 0, 0, 0
                db 0, 0, 0

data_C4C3:: db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0

data_C4D0:: db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 2, 1, 2, 2, 2, 3, 3, 0, 0, 0, 0, 0, 0, 0, 0
            db 0, 2, 2, 2, 4, 0, 1, 2, 0, 0, 0, 0, 1, 2, 2, 0
            db 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
            db 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 2, 2, 2, 2, 2, 0, 2, 2, 0, 0, 0, 0, 1, 1, 1, 1
            db 2, 2, 2, 2, 4, 0, 2, 2, 0, 0, 0, 0, 0, 1, 1, 1
            db 2, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0
            db 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0
            db 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 0, 0, 2, 0, 0, 2, 2, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 1, 0, 2, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 1, 2, 2, 0, 0, 2, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 1, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 1, 2, 1, 2, 0, 1, 2, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 1, 2, 1, 2, 0, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0
            db 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 1, 1, 2, 1, 0, 3, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 1, 1, 0, 0, 0, 1, 2, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 1, 2, 1, 2, 0, 1, 2, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 1, 2, 1, 2, 0, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0
            db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1
            db 1, 0, 2, 0, 2, 0, 3, 0, 0, 0, 0, 0, 1, 1, 1, 0
            db 0, 2, 2, 2, 2, 0, 0, 2, 0, 0, 0, 0, 1, 1, 1, 0
            db 0, 2, 0, 0, 5, 2, 3, 3, 0, 0, 0, 0, 0, 0, 0, 0
            db 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1
            db 1, 1, 2, 1, 4, 0, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0
            db 0, 0, 0, 2, 4, 0, 2, 2, 0

data_C6D9::      db 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 2, 4, 0, 3, 2, 0
                 db 0, 0, 0, 1, 1, 1

data_C6EF::     db 1, 1, 2, 2, 1, 1, 0, 3, 2, 0, 0, 0, 0, 6, 6, 6
                db 6, 6, 6, 6, 6, 6, 0, 6, 6, 0, 0, 0, 0, 0, 0, 0
                db 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 1, 1, 1
                db 1, 1, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 1, 1, 1
                db 1, 1, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0

data_C73C::     db 0, 1, 2, $40, 0, 0, $FF, 0, 0, 2, 1, $40, 0, 0, $FF, 0
                db 0, 4, 2, $40, 0, 0, $FF, 0, 0, 8, 4, $40, 0, 0, $FF, 0
                db 0, $10, 8, $40, 0, 0, $FF, 0, 0, 1, 4, $40, 0, 0, $FF, 0
                db 0, $FF, 2, $40, 0, 0, $FF, 0, 0, 1, 4, $40, 0, 0, $FF, 0
                db 0, $FF, $18, $FE, 2, $FD, $FF, 0, 0, $FF, $FD, $FE, 0, 0, 2, 0
                db 0, 1, 4, $FE, 0, 0, $FF, 0, 0, $FF, 2, $40, 0, 0, $FF, 0
                db 0, 1, 2, $40, 0, 0, $FF, 0, 0, 1, 2, $40, 0, 0, $FF, 0
                db 0, 1, 2, $40, 0, 0, $FF, 0, 0, 1, 2, $40, 0, 0, $FF, 0

data_C7BC::     db 1, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4
                db $C, $3F, 8, 8, 8, $C, 0, 0, 4, 6, 8, $A, 4, $14, $A, $18
                db 4, 2, 8, 8, 2, 4, $FF, 0, 2, 4, 2, 3, 1, 1, 8, 6
                db 2, $A, 1, 8, 8

data_C7F1::     db 4, 4, 8, 8, $18, 8, 4, 8, $10, 8, $10, 8, 8, 4, 8, 8
                db 8, 8, 8, 8, 8, $C, 0, 0, 8, 8, 8, $C, $C, $14, $10, $20
                db 8, 8, 4, 4, 4, 4, 4, 0, $14, 8, 4, 8, 4, 4, 8, 8
                db 4, 4, 4, 8, 8

data_C826::     db 2, 6, 1, 3, 3, 3, $D, 8, $A, 2, 7, $B, 0, 4, 0, 8
                db 4, $E, $E, $E, $E, $E, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3
                db 3, 2, 0, 0, 2, 0, 0, 0, 0, 6, 6, $D, $E, 0, 9, 3
                db 6, 0, 2, $E, $E

label_C85B::
    call label_3A0A
    ldh a, [hMapIndex]
    ld hl, $c3e0
    add  hl, bc
    ld   [hl], a
    ld   hl, $C460
    add  hl, bc
    ld   [hl], $FF

label_C86B::
    ld   hl, $C3A0
    add  hl, bc
    ld   e, [hl]
    ld   d, b
    ld   hl, data_4000
    add  hl, de
    ld   a, [hl]
    ld   hl, $C340
    add  hl, bc
    ld   [hl], a
    ld   hl, data_C0FB
    add  hl, de
    ld   a, [hl]
    ld   hl, $C350
    add  hl, bc
    ld   [hl], a
    call label_C895
    ld   hl, data_C2F1
    add  hl, de
    ld   a, [hl]
    ld   hl, $C430
    add  hl, bc
    ld   [hl], a
    jp   label_3AEA

label_C895::
    push de
    ld   hl, data_C1F6
    add  hl, de
    ld   e, [hl]
    ld   hl, $C4D0
    add  hl, bc
    ld   [hl], e
    ld   d, b
    ld   hl, data_C7BC
    add  hl, de
    ld   a, [hl]
    ld   hl, $C360
    add  hl, bc
    ld   [hl], a
    pop  de
    ret

label_C8AD::
    ld   a, $01
    ld   [$C18F], a
    jp   label_3F8D
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    and  $80
    jr   z, label_C918
    ldh  a, [$FFF8]
    and  $30
    jr   z, label_C8C7
    jp   label_3F8D

label_C8C7::
    ldh  a, [$FFEB]
    cp   $5F
    jr   nz, label_C8F0

    ldh a, [hMapIndex]
    cp   $95
    jr   z, label_C8F0
    cp   $92
    jr   z, label_C8F0
    cp   $84
    jr   z, label_C8E2
    ld   a, [$D984]
    and  $30
    jr   z, label_C8AD

label_C8E2::
    ld   a, [$D992]
    and  $30
    jr   z, label_C8AD
    ld   a, [$D995]
    and  $30
    jr   z, label_C8AD

label_C8F0::
    ld a, [wActiveRoom]
    and  a
    jr   z, label_C908
    ld   a, [$D478]
    and  a
    jr   nz, label_C90B
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    and  $04
    jr   z, label_C908
    ld   [$C1CF], a

label_C908::
    call label_27F2

label_C90B::
    xor  a
    ld   [$C1BD], a
    inc  a
    ld   [$C1BE], a
    ld   a, $20
    ld   [$C165], a

label_C918::
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $05
    ld   a, $03
    call label_9D3
    jp   hl

data_C924::
    db 1, 4

label_C926::
    ld   hl, $C460
    add  hl, bc
    ld   e, [hl]
    ld   d, b
    ld   hl, data_C924
    add  hl, de
    ld   a, [hl]
    jp   label_3B0C


    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    sub  a, $03
    ld   [hl], a
    ret
    call label_C00
    ld   [hl], $30
    ret


    ldh a, [hMapIndex]
    cp   $65
    ret  nz
    ldh  a, [$FFEC]
    cp   $50
    ret  c

    ld hl, wEntitiesUnknownTableB
    add  hl, bc
    inc  [hl]
    ret
    ld   hl, $C360
    add  hl, bc
    ld   [hl], $02
    ret


    ld hl, $db74
    ld a, [wIsMarinFollowingLink]
    or   [hl]
    jp   nz, label_3F8D
    ret
    ld   hl, $C310
    add  hl, bc
    ld   [hl], $10
    call GetRandomByte
    ld   hl, $C3D0
    add  hl, bc
    ld   [hl], a
    ret
    call label_CF83
    ld   a, $02
    jp   label_3B0C
    ld   a, $33
    jr   label_C995

    ld a, [wGoldenLeavesCount]
    cp   $06
    jr   c, label_C993

    ld hl, wEntity0PosX
    add  hl, bc
    ld   [hl], $58
    ld   hl, $C380
    add  hl, bc
    ld   [hl], $03

label_C993::
    ld   a, $40

label_C995::
    ld   e, a
    ld a, [wDidFindSword]
    and  a
    ret  z
    ld   a, e

label_C99C::
    ld [wWorldMusicTrack], a
    ldh [$b0], a
    ldh [$bd], a
    ldh [$bf], a
    ret
    xor  a
    ld   [$D219], a
    jp   label_27F2
    ld   a, $24
    jr   label_C99C
    ld   a, $3A
    jr   label_C99C
    xor  a
    ld [$C168], a
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    sub  a, $04
    ld   [hl], a
    ret
    call GetRandomByte
    jp   label_3B0C
    call label_BFB
    call GetRandomByte
    and  $3F
    add  a, $10
    ld   [hl], a
    ret


    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    add  a, $0A
    ld   [hl], a
    ld hl, wEntitiesUnknownTableC
    add  hl, bc
    ld   [hl], a
    ret
    xor  a
    ldh  [$FFB0], a
    ret
    call label_CA12
    ldh  a, [$FFEE]
    swap a
    and  $01
    add  a, $04
    jp   label_3B0C
    ldh  a, [$FFEE]
    swap a
    and  $01
    ld   e, a
    ldh  a, [$FFEF]
    swap a
    inc  a
    rla
    and  $02
    or   e
    call label_3B0C
    cp   $01
    jr   nz, label_CA12
    ld   a, [$DB4B]
    and  a
    jp   nz, label_3F8D

label_CA12::
    ld   hl, $C310
    add  hl, bc
    ld   [hl], $13
    ret
    ld   hl, $C380
    add  hl, bc
    ld   [hl], $02
    call IncrementEntityWalkingAttr
    call IsEntityFrameCounterZero
    ld   [hl], $20
    ret


    ldh a, [hMapIndex]
    cp $d9
    ld   a, $32
    jr   nz, label_CA32
    ld   a, $37

label_CA32::
    jr   label_CA4F
    ld   hl, $C310
    add  hl, bc
    ld   [hl], $10
    ld   a, [$DBA5]
    and  a
    jr   z, label_CA46

    ldh a, [hMapTileset]
    cp $ff
    jr   z, label_CA4D

label_CA46::
    ld   a, [$C5A9]
    and  a
    jp   nz, label_3F8D

label_CA4D::
    ld   a, $0C

label_CA4F::
    call label_C995
    ld de, $c220
    ld hl, wEntity0PosX
    jp   label_CF92


    ldh a, [hMapIndex]
    cp $e2
    jr   nz, label_CA6B

    ld a, [wIsBowWowFollowingLink]
    cp   $80
    jr   z, label_CA72
    jp   label_3F8D

label_CA6B::
    ld a, [wIsBowWowFollowingLink]
    and  a
    jp   nz, label_3F8D

label_CA72::
    ret
    ldh  a, [$FFF8]
    rra
    jr   label_CA7A
    ldh  a, [$FFF8]

label_CA7A::
    and  $10
    jp   nz, label_3F8D
    ret


    ldh a, [hMapIndex]
    cp $c0
    jr   c, label_CAA3
    ld   a, [$DB74]
    and  a
    jp   z, label_3F8D

    ld a, [wIsMarinFollowingLink]
    and  a
    jp   nz, label_3F8D
    inc  a
    ld   [$C3C8], a
    ld   a, $2F
    ldh  [hNextMusicTrack], a
    ldh  [$FFB0], a
    ldh  [$FFBD], a
    call label_27EA

label_CAA3::
    ld   a, [$0003]
    and  a
    jp   z, label_CB2F
    ld   a, [$DB4F]
    and  a
    jr   nz, label_CB2F
    ld   a, [$DB50]
    and  a
    jr   nz, label_CABF

    ld [wGameplaySubtype], a
    ld   a, $01
    ld [wGameplayType], a
    ret

label_CABF::
    ld   hl, $C3A0
    add  hl, bc
    ld   [hl], $6B
    ret

data_CAC6::
    rst  $38
    ld   a, a
    cp   [hl]
    rrca
    inc  de
    ld   [bc], a
    nop
    nop
    ldh a, [hIsGBC]
    and  a
    jr   z, label_CB2F

    ld a, [wActiveRoom]
    and  a
    jr   z, label_CB2F

    ld a, [wIsMarinFollowingLink]
    and  a
    jr   nz, label_CB2F

    ld a, [wHasInstrument3]
    and  $02
    jr   nz, label_CB2F

    ld a, [wTradeSequenceItem]
    cp   $04
    jr   nc, label_CB2F
    ld   a, [$DB48]
    and  a
    jr   z, label_CB2F
    cp   $01
    jr   z, label_CB2F
    ld   a, $02
    ld   [rSVBK], a
    ld   hl, $DC88
    ld   de, data_CAC6

label_CB01::
    ld   a, [de]
    ldi  [hl], a
    inc  de
    ld   a, l
    and  $07
    jr   nz, label_CB01
    xor  a
    ld   [rSVBK], a
    jr   label_CB2F

    ld a, [wIsBowWowFollowingLink]
    cp   $80
    jr   nz, label_CB1A

    ld a, $0e
    ld [wWorldMusicTrack], a

label_CB1A::
    ret


    ld a, [wActiveRoom]
    and  a
    jr   nz, label_CB2F
    ld   a, [$D477]
    and  a
    ret  nz

    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    sub  a, $10
    ld   [hl], a
    ret

label_CB2F::
    ld   hl, $C380
    add  hl, bc
    ld   [hl], $03
    ld a, [wShieldLevel]
    and  a
    jr   nz, label_CB40
    ld   a, $1C
    call label_C99C

label_CB40::
    jr   label_CB48
    ret
    ld   a, $07
    call label_C995

label_CB48::
    ld   a, $01
    jr   label_CB51
    call GetRandomByte
    and  $03

label_CB51::
    ld   hl, $C380
    add  hl, bc
    ld   [hl], a

label_CB56::
    ret
    ld   a, $03
    ld   [rIE], a
    ret
    ld   a, $FF
    jp   label_3B0C


    ld a, [wActiveRoom]
    and  a
    jr   z, label_CB56

    ldh a, [hMapIndex]
    cp $da
    jr   nz, label_CB56

    ld a, [wTradeSequenceItem]
    cp $0e
    jp   nz, label_3F8D

    ld a, [wPhotos2]
    and  $01
    jr   z, label_CB56
    ld   a, $03
    jp   label_3B0C
    xor  a
    jr   label_CB51

label_CB84::
    ld hl, $dde0
    ldh a, [hMapIndex]
    ld   e, a
    ld   d, $00
    add  hl, de
    ld   a, [hl]
    ret
    call label_CB84
    and  $10
    jr   nz, label_CBAD
    xor  a
    jp   label_3B0C
    call label_CB84
    and  $10
    jr   nz, label_CBAD
    ld   a, $04
    jp   label_3B0C
    call label_CB84
    and  $10
    jr   z, label_CBB3

label_CBAD::
    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   [hl], $80

label_CBB3::
    ld   a, $08
    jp   label_3B0C


    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   [hl], $03
    jr   label_CBC2
    ld   a, $04

label_CBC2::
    ld   hl, $C310
    add  hl, bc
    ld   [hl], $10
    jp   label_3B0C
    ld   hl, $C360
    add  hl, bc
    ld   [hl], $10
    ld hl, wEntity0PosX
    add  hl, bc
    ld   a, [hl]
    sub  a, $08
    ld   [hl], a
    jp   label_CB56


    ld hl, wEntity0PosX
    add  hl, bc
    ld   [hl], $50
    ld hl, wEntitiesUnknownTableD
    add  hl, bc
    ld   [hl], $00
    jp   label_CB56


    ldh a, [hIsGBC]
    and  a
    jp   z, label_CB56
    call label_CB84
    and  $10
    jp   z, label_CB56

    ld hl, wEntity0PosX
    add  hl, bc
    ld   a, $3C
    jr   label_CC15

    ldh a, [hIsGBC]
    and  a
    jp   z, label_CB56
    call label_CB84
    and  $10
    jp   z, label_CB56

    ld hl, wEntity0PosX
    add  hl, bc
    ld   a, $63

label_CC15::
    ld   [hl], a
    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   [hl], $04
    jp   label_CB56


    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    add  a, $02
    ld   [hl], a
    ld   hl, $C310
    add  hl, bc
    ld   [hl], $04
    ld   hl, $C360
    add  hl, bc
    ld   [hl], $0C
    xor  a
    ld hl, wEntitiesUnknownTableD
    add  hl, bc
    ld   [hl], a
    ld hl, wEntity0PosX
    add  hl, bc
    ld   a, [hl]
    add  a, $08
    ld   [hl], a
    jp   label_CB56

data_CC44::
    inc  [hl]
    ld   [bc], a
    inc  [hl]
    ldi  [hl], a
    inc  [hl]
    inc  d
    inc  [hl]
    inc  [hl]
    call IsEntityFrameCounterZero
    jr   z, label_CC77

    ldh a, [hFrameCounter]
    rra
    rra
    rra
    and  $01
    ldh  [$FFF1], a
    ld   de, data_CC44
    call label_3BC0
    ld   hl, $C3B0
    add  hl, bc
    ld   a, [hl]
    ldh  [$FFF1], a
    call label_3A81
    call label_FF7E
    call label_FFA9
    call label_E0B3
    call label_3D7F
    ret

label_CC77::
    ldh  a, [$FFEB]
    cp   $1F
    jr   nz, label_CC8C
    ld   hl, $C3A0
    add  hl, bc
    ld [hl], $1e
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $05
    jp   label_C86B

label_CC8C::
    ld   hl, $C480
    add  hl, bc
    ld [hl], $1f
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $01
    ld   hl, $C340
    add  hl, bc
    ld   [hl], $04
    ld   hl, $FFF4
    ld   [hl], $13
    ret

data_CCA4::
    db 0, 0, 4, 0

data_CCA8::
    db 0, 1, 3, 6

data_CCAC::
    db $24, 1, $24, 1, $3E, 1

data_CCB2::
    ld   e, $01
    ld   e, $61
    ldh a, [hMapTileset]
    cp $ff
    jr   nz, label_CCDC
    ld   hl, $C3A0
    add  hl, bc
    ld   a, [hl]
    cp   $E9
    jr   z, label_CCCD
    cp   $EA
    jr   z, label_CCCD
    cp   $EB
    jr   nz, label_CCDC

label_CCCD::
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   a, $05
    ld   [hl], a
    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   a, $06
    ld   [hl], a
    ret

label_CCDC::
    call IsEntityFrameCounterZero
    jr   nz, label_CD07
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    and  $02
    jr   nz, label_CCEF
    ld   hl, $D460
    ld   [hl], $01

label_CCEF::
    ldh  a, [$FFEB]
    cp   $A8
    jr   nz, label_CD04
    ld   a, $16
    ld   [$DB6F], a
    ld   a, $50
    ld   [$DB70], a
    ld   a, $27
    ld   [$DB71], a

label_CD04::
    jp   label_3F8D

label_CD07::
    cp   $40
    jr   c, label_CD29
    ldh  a, [$FFEB]
    cp   $09
    jr   z, label_CD19
    cp   $0B
    jr   z, label_CD19
    cp   $14
    jr   nz, label_CD22

label_CD19::
    call label_D8FC
    call label_D8FC
    call label_D8FC

label_CD22::
    call label_3A81
    call label_FF7E
    ret

label_CD29::
    rra
    rra
    rra
    rra
    and  $03
    ld   hl, $C3B0
    add  hl, bc
    ld   [hl], a
    ldh  [$FFF1], a
    ld   e, a
    ld   d, b
    ld   hl, data_CCA4
    add  hl, de
    ldh  a, [$FFEC]
    add  a, [hl]
    ldh  [$FFEC], a
    ld   a, e
    cp   $03
    jr   nz, label_CD51
    xor  a
    ldh  [$FFF1], a
    ld   de, data_CCB2
    call label_3BC0
    jr   label_CD57

label_CD51::
    ld   de, data_CCAC
    call label_3C77

label_CD57::
    call label_FF7E
    call IsEntityFrameCounterZero
    cp   $3F
    jr   nz, label_CD66
    ld   hl, $FFF2
    ld   [hl], $18

label_CD66::
    rra
    rra
    rra
    rra
    and  $03
    ld   e, a
    ld   d, b
    ld   hl, data_CCA8
    add  hl, de
    ld   e, [hl]
    ldh a, [hLinkPositionX]
    push af
    ld   hl, $C4B0
    add  hl, bc

label_CD7A::
    ld   a, [hl]
    ldh [hLinkPositionX], a
    ldh a, [hLinkPositionY]
    push af
    ld   hl, $C4C0
    add  hl, bc
    ld   a, [hl]
    ldh [hLinkPositionY], a
    ld   a, e
    call label_FEC7
    pop  af
    ldh [hLinkPositionY], a
    pop  af
    ldh [hLinkPositionX], a
    jp   label_FF25
    call label_3A81
    call label_FF7E
    ld   hl, $C410
    add  hl, bc
    ld   [hl], $02
    call label_E0B3
    ld   hl, $C410
    add  hl, bc
    ld   [hl], b
    call label_E6FA
    call label_D438
    ldh  a, [$FFEB]
    cp   $5C
    jr   nz, label_CDD2

    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_CDD2
    ld   hl, $C420
    add  hl, bc
    ld   [hl], $20
    ld   hl, $FFF3
    ld   [hl], $07
    ld   hl, $C440
    add  hl, bc
    ld   a, [hl]
    inc  a
    ld   [hl], a
    cp   $03
    jr   z, label_CDEF

label_CDD2::
    ld   a, $0B
    ld   [$C19E], a
    call label_F5A2
    ld   hl, $C240
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C250
    add  hl, bc
    or   [hl]
    jr   nz, label_CE04
    call label_F267
    ldh  a, [$FFEB]
    cp   $5C
    jr   nz, label_CE04

label_CDEF::
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $05
    call IncrementEntityWalkingAttr
    ld   [hl], $01
    call IsEntityFrameCounterZero
    ld   [hl], $80
    ld hl, wEntitiesUnknownTableD
    add  hl, bc
    ld   [hl], b

label_CE04::
    ret

data_CE05::
    db   $10, $F0 ; Undefined instruction
    call label_3A81
    call label_FF7E
    call label_FFA9
    call label_E0B3
    call label_3D7F
    call label_EE2B
    ld a, [wAButtonSlot]
    cp   $03
    jr   nz, label_CE28
    ldh  a, [$FFCC]
    and  $20
    jr   nz, label_CE35
    jr   label_CE72

label_CE28::
    ld a, [wBButtonSlot]
    cp   $03
    jr   nz, label_CE72
    ldh  a, [$FFCC]
    and  $10
    jr   z, label_CE72

label_CE35::
    ld   a, [$C3CF]
    and  a
    jr   nz, label_CE72
    ld   hl, $C340
    add  hl, bc
    ld   a, [hl]
    push hl
    push af
    or   $80
    ld   [hl], a
    call label_EC72
    rl   e
    pop  af
    pop  hl
    ld   [hl], a
    rr   e
    jr   nc, label_CE72
    ld   a, $01
    ld [$c3cf], a
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $07
    ld   a, $02
    ldh [hSFX], a
    ld hl, $c490
    add  hl, bc
    ld   [hl], b
    call IsEntityFrameCounterZero
    ld   [hl], $02
    ldh  a, [$FF9E]
    ld   [$C15D], a
    jp   label_D732

label_CE72::
    ld   hl, $C300
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   nz, label_CE85

    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $05
    ld   hl, $C320
    add  hl, bc
    ld   [hl], b

label_CE85::
    cp   $38
    ret  nc
    srl  a
    srl  a
    and  $01
    ld   e, a
    ld   d, b
    ld   hl, data_CE05
    add  hl, de
    ld   a, [hl]
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    call label_FF32
    jp   label_3D7F

data_CEA0::
    inc  c
    inc  c
    db   $F4 ; Undefined instruction
    db   $F4 ; Undefined instruction

data_CEA4::
    inc  c
    db   $F4 ; Undefined instruction
    inc  c
    db   $F4 ; Undefined instruction
    call GetRandomByte
    and  $03
    ld   e, a
    ld   d, b
    ld   hl, data_CEA0
    add  hl, de
    ld   a, [hl]
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    ld   hl, data_CEA4
    add  hl, de
    ld   a, [hl]
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a
    ret


    ld hl, wEntitiesUnknownTableC
    add  hl, bc
    ld   [hl], $04
    ld   a, $03
    jr   label_CED0
    ld   a, $FD

label_CED0::
    ld hl, wEntitiesPosYTable
    add  hl, bc
    add  a, [hl]
    ld   [hl], a
    ret
    call IsEntityFrameCounterZero
    ld   [hl], $80
    ld   hl, $C3B0
    add  hl, bc
    dec  [hl]
    ret
    ldh  a, [$FFEE]
    and  $10
    ld   a, $00
    jr   nz, label_CEEC
    ld   a, $03

label_CEEC::
    ld   hl, $C380
    add  hl, bc
    ld   [hl], a
    push hl
    call label_D8FC
    pop  hl
    ld   a, [hl]
    xor  $01
    ld   [hl], a
    ret


    ld hl, wEntitiesUnknownTableD
    add  hl, bc
    ld   [hl], $02
    ldh a, [hMapIndex]
    cp $a4
    jr   z, label_CF0B
    cp   $D2
    jr   nz, label_CF0F

label_CF0B::
    dec  [hl]
    call label_CF83

label_CF0F::
    jp   label_CF24

label_CF12::
    ld hl, wEntitiesUnknownTableD
    add  hl, bc
    ld   [hl], $01
    ld a, [wActiveRoom]
    and  a
    jr   z, label_CF24

    ld hl, wEntitiesUnknownTableD
    add  hl, bc
    ld   [hl], $02

label_CF24::
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    or   $11
    ld   [hl], a
    ret


    ldh a, [hMapIndex]
    cp $f8
    jr   nz, label_CF44
    ldh  a, [$FFF8]
    bit  4, a
    jp   nz, label_3F8D
    bit  5, a
    jp   z, label_3F8D
    ld   a, $02
    jp   label_3B0C

label_CF44::
    cp   $7A
    jr   nz, label_CF54
    ldh  a, [$FFF8]
    and  $10
    jp   nz, label_3F8D
    ld   a, $04
    jp   label_3B0C

label_CF54::
    cp   $7C
    jr   nz, label_CF67
    ld   a, [$D969]
    and  $10
    jp   z, label_3F8D
    ldh  a, [$FFF8]
    and  $10
    jp   nz, label_3F8D

label_CF67::
    ret


    ld a, [wTradeSequenceItem]
    cp $0e
    jr   z, label_CF83
    ret


    ld a, [wActiveRoom]
    and  a
    ret  z
    call IncrementEntityWalkingAttr
    jr   label_CF83
    call label_CF12
    ld a, [wActiveRoom]
    and  a
    jr   nz, label_CFA9

label_CF83::
    ld de, $c220
    ld hl, wEntity0PosX
    call label_CF92
    ld de, $c230
    ld hl, wEntitiesPosYTable

label_CF92::
    add  hl, bc
    ld   a, [hl]
    add  a, $08
    ld   [hl], a
    rla
    ld   l, e
    ld   h, d
    add  hl, bc
    rra
    ld   a, [hl]
    adc  a, $00
    ld   [hl], a
    ret


    ld de, $c220
    ld hl, wEntity0PosX
    jr   label_CF92

label_CFA9::
    call label_BFB
    ld   [hl], $80
    ret
    call label_C00
    ld   [hl], $A0
    ret
    ldh  a, [$FFEB]
    cp   $12
    jr   nz, label_CFC8

    ld hl, wEntitiesUnknownTableD
    add  hl, bc
    ld   [hl], $01
    ld   hl, $C310
    add  hl, bc
    ld   [hl], $10
    ret

label_CFC8::
    jp   IncrementEntityWalkingAttr

label_CFCB::
    ld   h, b
    ld   [bc], a
    ld   h, d
    ld   [bc], a
    ld   h, d
    ldi  [hl], a
    ld   h, b
    ldi  [hl], a
    ld   h, h
    ld   [bc], a
    ld   h, [hl]
    ld   [bc], a
    ld   h, [hl]
    ldi  [hl], a
    ld   h, h
    ldi  [hl], a
    ld   l, b
    ld   [bc], a
    ld   l, d
    ld   [bc], a
    ld   l, h
    ld   [bc], a
    ld   l, [hl]
    ld   [bc], a
    ld   l, d
    ldi  [hl], a
    ld   l, b
    ldi  [hl], a
    ld   l, [hl]
    ldi  [hl], a
    ld   l, h
    ldi  [hl], a

label_CFEB::
    ld   [hl], b
    ld   [bc], a
    ld   [hl], d
    ld   [bc], a
    ld   [hl], d
    ldi  [hl], a
    ld   [hl], b
    ldi  [hl], a

label_CFF3::
    inc  c
    db   $F4 ; Undefined instruction
    nop
    nop

data_CFF7::
    db 0, 0, $F4, $C, $21, $C0, $C2, 9, $7E, $A7, $28, $45, $11, $EB, $4F, $CD
    db $C0, $3B, $CD, $78, $7F, $CD, $A9, $7F, $CD, $28, $6E, $CD, $25, $7F, $CD, $93
    db $78, $CD, 5, $C, $20, $20, $CD, $D, $28, $E6, $1F, $C6, $20, $77, $E6, 3
    db $5F, $50, $21, $F3, $4F, $19, $7E, $21, $40, $C2, 9, $77, $21, $F7, $4F, $19
    db $7E, $21, $50, $C2, 9, $77

data_D03D::
    db $F0, $E7, $1F, $1F, $1F, $1F, $E6, 1, $C3, $C, $3B

data_D048::      db $11, $CB, $4F, $CD, $3C
data_D04D::      db $58, $C9

data_D04F::
    db $62, $70, $63, $71

data_D053::
    db $62, $70, $62, $70

; Item ID mapped to chest ID (IE Chest ID $07 points to item ID $0A (Roc's Feather))
data_D057:: db 3, 4, 5, 6, 7, 8, 9, $A, $B, $C, 2, 1, 0, 0, 0, 0
            db 1

label_D068::
    ldd  [hl], a
    inc  d
    ld   h, h
    ret  z
    db   $F4 ; Undefined instruction
    ld   a, $2A
    ld   [$C111], a
    ld   a, $04
    ldh  [$FFF4], a
    ld   de, data_D04F
    ldh  a, [$FFFE]
    and  a
    jr   z, label_D081
    ld   de, data_D053

label_D081::
    ld   b, $A1
    call label_D1C9
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    sub  a, $08
    ld   [hl], a
    ld   hl, $C250
    add  hl, bc
    ld   [hl], $FC
    ld   hl, $C3B0
    add  hl, bc
    ld   a, [hl]
    ldh  [$FFE8], a
    ld   d, b
    cp   CHEST_TAIL_KEY_ID
    jr   nz, label_D0AC
    push af
    ld   a, [$C501]
    ld   e, a
    ld hl, wEntitiesUnknowTableF
    add  hl, de
    ld   [hl], $38
    pop  af

label_D0AC::
    ld   e, a
    cp   CHEST_MESSAGE_ID
    jp   nc, label_D12A
    cp   CHEST_SECRET_SEASHELL_ID
    jr   nz, label_D0B9
    jp   label_E36D

label_D0B9::
    cp   CHEST_50_RUPEES_ID ; Jump if chest less than $1B (could be dungeon item, inventory item or dungeon key)
    jr   c, label_D0D8
    cp   $20
    jr   nc, label_D0D8
    ld   hl, data_D04D
    add  hl, de
    ld   a, [hl]
    ld   [wAddRupeeBufferHigh], a
    ld   hl, data_D048
    add  hl, de
    ld   a, [hl]
    ld   [$DB8F], a
    ld   a, $18
    ld   [$C3CE], a
    jr   label_D12A

label_D0D8::
    cp   CHEST_MAP_ID ; Jump if chest less than $16 (could be dungeon key or inventory item)
    jr   c, label_D0EF
    cp   $1B
    jr   nc, label_D0EF
    sub  a, $16
    ld   e, a
    ld   d, $00
    ld hl, wHasDungeonMap
    add  hl, de
    inc  [hl]
    call label_2802
    jr   label_D12A

label_D0EF::
    cp   CHEST_FLIPPERS_ID ; Jump if chest greater than $0C (could be a dungeon item or lens/medicine)
    jr   nc, label_D125
    ldh  a, [$FFE8]
    cp   CHEST_SHIELD_ID
    jr   nz, label_D0FD

    ld hl, wShieldLevel
    inc  [hl]

; Called When opening Feather chest with af = $0740, de = $0007, bc = $000F, $FFE8 = 07
label_D0FD::
    cp   CHEST_POWER_BRACELET_ID
    jr   nz, label_D10C

    ld a, [wPowerBraceletLevel]
    cp   $02
    jr   z, label_D10C

    ld hl, wPowerBraceletLevel
    inc  [hl]

label_D10C::
    ldh  a, [$FFE8]
    cp   CHEST_BOMB_ID
    jr   nz, label_D11A

    ld hl, wBombCount
    ld   a, [hl]
    add  a, $01
    daa
    ld   [hl], a
; Opening Chest?
label_D11A::
    ld   d, b
    ld   hl, data_D057
    add  hl, de
    ld   d, [hl]
    call AddItemToInventory
    jr   label_D12A

label_D125::
    ld hl, wAButtonSlot
    add  hl, de
    inc  [hl]
	
; Remove entity from screen?
label_D12A::
    call label_D134
    ld   a, [hl]
    or   $10
    ld   [hl], a
    ldh  [$FFF8], a
    ret

label_D134::
    ld a, [wActiveRoom]
    ld   d, a
    ld hl, wMinimapTiles
    ldh a, [hMapIndex]
    ld   e, a
    ldh a, [hMapTileset]
    cp $ff
    jr   nz, label_D14B
    ld   d, $00
    ld   hl, $DDE0
    jr   label_D154

label_D14B::
    cp   $1A
    jr   nc, label_D154
    cp   $06
    jr   c, label_D154
    inc  d

label_D154::
    add  hl, de
    ret

data_D156::
    db $6A, $7A, $6B, $7B

data_D15A::
    db $10, $12, $11, $13

data_D15E::
    db $F8, $F9, $FA, $FB

data_D162::
    db $E, $1E, $F, $1F

data_D166::
    db $68, $77, $69, $4B

data_D16A::
    db $76, $76, $76, $76

label_D16E::
    call label_FEFE
    ld   d, $00
    ld   hl, data_D23D
    add  hl, de
    ld   a, [hl]
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    ld   hl, data_D241
    add  hl, de
    ld   a, [hl]
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a
    call label_D249
    call label_F893
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_D198
    jp   label_3F8D

label_D198::
    ld   a, $11
    ldh  [$FFF4], a
    ld   de, data_D166
    ld b, $c6
    ldh a, [hMapIndex]
    cp   $77
    jr   nz, label_D1B3
    ld   a, [$DDD9]
    cp   $80
    jr   z, label_D1B3
    ld   de, data_D16A
    ld   b, $03

label_D1B3::
    ld a, [wActiveRoom]
    and  a
    jr   z, label_D1C9
    ld   de, data_D15A
    ld b, $0d
    ldh a, [hMapIndex]
    cp $c7
    jr   nz, label_D1C9
    ld   de, data_D156
    ld   b, $BE

label_D1C9::
    push de
    ld   a, b
    push af
    ld   b, $00
    ldh  a, [$FFEF]
    sub  a, $0F
    ldh  [$FFCD], a
    ldh  a, [$FFEE]
    sub  a, $07
    ldh  [$FFCE], a
    swap a
    and  $0F
    ld   e, a
    ldh  a, [$FFCD]
    and  $F0
    or   e
    ld   e, a
    ld   d, $00
    ld hl, wTileMap
    add  hl, de
    pop  af
    ld   [hl], a
    ld   [$DDD8], a
    ld   a, $03
    call label_B2F

label_D1F5::
    call label_2887
    ld a, [wRequests]
    ld   e, a
    ld   d, $00
    ld hl, wRequestDestinationHigh
    add  hl, de
    add $0a
    ld [wRequests], a
    pop  de
    ldh  a, [$FFCF]
    ldi  [hl], a
    ldh  a, [$FFD0]
    ldi  [hl], a
    ld   a, $81
    ldi  [hl], a
    ld   a, [de]
    inc  de
    ldi  [hl], a
    ld   a, [de]
    inc  de
    ldi  [hl], a
    ldh  a, [$FFCF]
    ldi  [hl], a
    ldh  a, [$FFD0]
    inc  a
    ldi  [hl], a
    ld   a, $81
    ldi  [hl], a
    ld   a, [de]
    inc  de
    ldi  [hl], a
    ld   a, [de]
    ldi  [hl], a
    xor  a
    ld   [hl], a
    ldh a, [hIsGBC]
    and  a
    jr   z, label_D234
    push bc
    ld   a, $03
    call label_91D
    pop  bc

label_D234::
    ret

data_D235::
    db $6E, 7, $6E

data_D238::
    db $27, $F8, $17, $FA, $17

data_D23D::
    db $F8, 8, 0, 0

data_D241::
    db 0, 0, 8, $F8

data_D245::
    db $7E, 7, $7E, $27

label_D249::
    ld a, [wActiveRoom]
    ldh [$f1], a
    ld   de, data_D235
    and  a
    jr   nz, label_D25D

    ldh a, [hMapIndex]
    cp   $77
    jr   nz, label_D25D
    ld   de, data_D245

label_D25D::
    call label_3BC0
    call label_FF78
    call label_FF25
    call label_D2D4
    call label_EC77
    jr   nc, label_D276
    call label_CBE
    ld   a, $03
    ld   [$C144], a

label_D276::
    ldh a, [hMapIndex]
    cp $c7
    jr   z, label_D282

    ld a, [wActiveRoom]
    and  a
    jr   nz, label_D286

label_D282::
    ld   a, $02
    ldh  [$FFA1], a

label_D286::
    ld   hl, $C3D0
    add  hl, bc
    ld   a, [hl]
    inc  a
    ld   [hl], a
    cp   $21
    ret  nz
    ld   hl, $C410
    add  hl, bc
    ld   [hl], a
    call label_F893
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   a, [hl]
    and  a
    ret  z
    cp   $02
    ret  z
    call label_3F8D
    ld   de, data_D162
    ld b, $c4
    ld a, [wActiveRoom]
    and  a
    jr   z, label_D2B5
    ld   de, data_D15E
    ld   b, $A6

label_D2B5::
    call label_D1C9
    ld   a, [$C18E]
    and  $1F
    cp   $02
    jr   z, label_D2D1
    cp   $07
    ret  nz
    call label_F893
    ld   a, [$C503]
    cp   $A7
    jr   z, label_D2D1
    cp   $A6
    ret  nz

label_D2D1::
    jp   label_C60

label_D2D4::
    ld   e, $0F
    ld   d, b

label_D2D7::
    ld hl, wEntitiesTypeTable
    add  hl, de
    ld   a, [hl]
    cp   $05
    jr   c, label_D31E
    ld   hl, $C340
    add  hl, de
    ld   a, [hl]
    and  $40
    jr   nz, label_D31E

    ld hl, wEntity0PosX
    add  hl, de
    ldh  a, [$FFEE]
    sub  a, [hl]
    add  a, $0C
    cp   $18
    jr   nc, label_D31E

    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   a, [hl]
    ld   hl, $C310
    add  hl, de
    sub  a, [hl]
    ld   hl, $FFEC
    sub  a, [hl]
    add  a, $0C
    cp   $18
    jr   nc, label_D31E
    ld   hl, $C340
    add  hl, de
    ld   a, [hl]
    and  $20
    jr   nz, label_D31E
    push bc
    ld   c, e
    ld   b, d
    push de
    ld   a, $08
    call label_EFCC
    pop  de
    pop  bc

label_D31E::
    dec  e
    ld   a, e
    cp   $FF
    jp   nz, label_D2D7
    ret
    ld   d, $03
    ld   a, c
    ld   [$C50C], a
    call label_C00
    ldh  [$FFD7], a
    jp   z, label_D3A8
    cp   $01
    jr   nz, label_D395
    ld   hl, $C390
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_D369
    call GetRandomByte
    and  $03
    jr   nz, label_D369
    ld   a, $2F
    call label_E4CA
    jr   c, label_D369

    ldh a, [$d7]
    ld hl, wEntity0PosX
    add  hl, de
    ld   [hl], a
    ldh a, [$d8]
    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   [hl], a
    ldh  a, [$FFDA]
    ld   hl, $C310
    add  hl, de
    ld   [hl], a
    ld   hl, $C450
    add  hl, de
    ld   [hl], $80

label_D369::
    ldh  a, [$FFF1]
    and  a
    jr   nz, label_D392

    ldh a, [hMapTileset]
    cp $1e
    jr   z, label_D378
    cp   $10
    jr   nz, label_D392

label_D378::
    ld a, [wIsMarinFollowingLink]
    and  a
    jr   z, label_D392
    call GetRandomByte
    and  $3F
    jr   nz, label_D38D
    ld   a, $28
    call label_2385
    jp   label_3F8D

label_D38D::
    ld   a, $99
    call label_2373

label_D392::
    jp   label_3F8D

label_D395::
    jp   label_3935

data_D398::
    db $F0, $17, $F2

data_D39B::
    db $17, $F4, $16, $F6, $16

data_D3A0::
    db $F0, $16, $F2, $16, $F4, $16, $F6, $16

label_D3A8::
    ld   a, [$DBA5]
    and  a
    jr   z, label_D3B3
    ld   de, data_D3A0
    jr   label_D3B6

label_D3B3::
    ld   de, data_D398

label_D3B6::
    call label_3BC0
    call label_FF78
    ld   a, $0B
    ld   [$C19E], a
    call label_F5A2
    call label_E0B3
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   a, [hl]
    cp   $02
    jp   z, label_D406
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_D3E4

    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_D406
    call label_D438

label_D3E4::
    ld   hl, $FFF4
    ld   [hl], $05
    ld   e, $1F
    ldh  a, [$FFF1]
    cp   $FF
    jr   z, label_D3F9
    cp   $01
    jr   z, label_D3F9
    ld   [hl], $09
    ld   e, $0F

label_D3F9::
    ld hl, wEntitiesUnknowTableF
    add  hl, bc
    ld   [hl], e
    ld   hl, $C340
    add  hl, bc
    ld   a, [hl]
    add  a, $02
    ld   [hl], a

label_D406::
    ret

label_D407::
    db $3E, 5, $CD, $CA, $64, $D8, $F0, $D7, $21, 0, $C2, $19, $77, $F0

data_D415::
    db $D8, $21, $DA, $FF, $96, $21, $10, $C2, $19, $77, $21, $B0, $C3, $19, $36, 0
    db $21, $F0, $C2, $19, $36, $F, $21, $40, $C3, $19, $36, $C4, $3E, 9, $E0, $F4
    db $C3, $8D, $3F

label_D438::
    ld   hl, $C2A0
    add  hl, bc
    ld   a, [hl]
    and  a
    ret  z
    ld   a, [$C18E]
    and  $1F
    cp   $0D
    jr   nz, label_D467
    ld   a, [$C503]
    cp   $A0
    jr   z, label_D455
    ld   a, [$C50D]
    cp   $A0
    ret  nz

label_D455::
    ld   a, $30
    ldh  [$FFCE], a
    ld   a, $20
    ldh  [$FFCD], a
    ld   a, $19
    ldh  [$FFDF], a
    call label_3E4D
    jp   label_C60

label_D467::
    db $FE, $B, $C0, $FA, $D, $C5, $FE, $35, $D8, $FE, $3D, $38, 9, $FA, 3, $C5
    db $FE, $35, $D8, $FE, $3D

data_D47C::
    db $D0, $C3, $60, $C, $32, 1, $32, $61

data_D484::
    db $30, 1, $30, $61

data_D488::
    db 0, 0, $3C, 1, 0, 8, $3C, $21, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF
    db 0, 0, $3A, 1, 0, 8, $3A, $21, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF
    db $FA, $FA, $3A, 1, $FA, 2, $3A, $21, 6, 6, $3A, 1, 6, $E, $3A, $21
    db 4, $FC, $30, 1, 4, 4, $30, $21, $FC, 4, $30, 1, $FC, $C, $30, $21

data_D4C8::
    db 0, 0, $3A, 1, 0, 8, $3A, $21, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF
    db $F8, $F8, $3A, 1, $F8, 0, $3A, $21, 8, 8, $3A, 1, 8, $10, $3A, $21
    db 8, $F8, $3A, 1, 8, 0, $3A, $21, $F8, 8, $3A, 1, $F8, $10, $3A, $21
    db $F8, $F8, $10, 2, $F8, 0, $12, 2, $F8, 8, $12, $22, $F8, $10, $10, $22
    db 8, $F8, $10, $42, 8, 0, $12, $42, 8, 8, $12, $62, 8, $10, $10, $62
    db $21, $30, $C4, 9, $7E, $E6, $80, $28, 3, $C3, $8D, $3A

label_D524::
    ld   hl, $C480
    add  hl, bc
    ld   a, [hl]
    and  a
    jp   z, label_3F50
    push af
    ld   hl, $C4A0
    add  hl, bc
    ld   a, [hl]
    ld   hl, data_D488
    and  a
    jr   z, label_D53C
    ld   hl, data_D4C8

label_D53C::
    pop  af
    cp   $20
    jr   nc, label_D56F
    rla
    and  $30
    ld   e, a
    ld   d, b
    add  hl, de
    cp   $30
    jr   nz, label_D555
    push hl
    ld   hl, $C4A0
    add  hl, bc
    ld   a, [hl]
    pop  hl
    and  a
    jr   nz, label_D55C

label_D555::
    ld   c, $04
    call label_3CE6
    jr   label_D568

label_D55C::
    ld   c, $08
    call label_3CE6
    ld   a, $04
    call label_3DA0
    jr   label_D568

label_D568::
    call label_FF78
    call label_FFA9
    ret

label_D56F::
    call label_3A81
    call label_FF7E
    ld   hl, $C410
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   nz, label_D599
    ld   hl, $C480
    add  hl, bc
    ld [hl], $1f
    ld a, [wTunicType]
    and  a
    jr   nz, label_D594
    ld   a, [wActivePowerUp]
    cp   $01
    jr   nz, label_D594
    ld   a, $12
    ldh [hSFX], a

label_D594::
    ld   hl, $FFF4
    ld   [hl], $13

label_D599::
    call label_FFA9

data_D59C::
    db $C9, $2E, $2E, $2D, $2D, $37, $2D, $FF, $FF, $2F, $37, $38, $2E, $2F

data_D5AA::
    db $2F, 3, 1, 1, 0, 3, 3, 3, 3, 1, 0, 0, 0, 3

data_D5B8::
    db 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0

data_D5C7::
    db $2E, $2D, $38, $2F, $2E, $2D, $38, $37

label_DC5F::
    ldh  a, [$FFEB]
    cp   $23
    jr   nz, label_D5E2

    ld hl, wEntitiesUnknownTableB
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_D5E2
    ld   a, $31
    jp   label_D670

label_D5E2::
    ld   hl, $C4E0
    add  hl, bc
    ld   a, [hl]
    cp   $FF
    ret  z
    and  a
    jp   nz, label_D670
    ld   a, [$D471]
    inc  a
    ld   [$D471], a
    cp   $0C
    jr   c, label_D60F
    xor  a

label_D5FA::
    ld   [$D471], a
    ld   a, [$C1BE]
    ld   hl, wActivePowerUp
    or   [hl]
    ld   hl, $FFF9
    or   [hl]
    jr   nz, label_D60F
    ld   a, $34
    jp   label_D670

label_D60F::
    ld   hl, $C4D0
    add  hl, bc
    ld   d, b
    ld   e, [hl]
    ld   hl, data_C826
    add  hl, de
    ld   a, [hl]
    and  a
    ret  z
    ld   e, a
    ld   d, $1E
    ld   a, [$DB5B]
    cp   $07
    jr   c, label_D62E
    ld   d, $23
    cp   $0B
    jr   c, label_D62E
    ld   d, $28

label_D62E::
    ld hl, wKillCount
    inc  [hl]
    ld   a, [hl]
    cp   d
    jr   c, label_D648
    ld   [hl], b
    ld   a, [$C1BE]
    ld   hl, $FFF9
    or   [hl]
    ld   hl, wActivePowerUp
    or   [hl]
    jr   nz, label_D648
    ld   a, $33
    jr   label_D670

label_D648::
    ld   d, b
    ld   hl, data_D5AA
    ld   a, [$C163]
    and  a
    jr   z, label_D655
    ld   hl, data_D5B8

label_D655::
    add  hl, de
    call GetRandomByte
    and  [hl]
    ret  nz
    ld   hl, data_D59C
    add  hl, de
    ld   a, [hl]
    cp   $FF
    jr   nz, label_D670
    call GetRandomByte
    and  $07
    ld   e, a
    ld   d, b
    ld   hl, data_D5C7
    add  hl, de
    ld   a, [hl]

label_D670::
    call label_E4CA
    ret  c

    ld hl, wEntitiesUnknownTableB
    add  hl, bc
    ld   a, [hl]
    ld hl, wEntitiesUnknownTableB
    add  hl, de
    ld   [hl], a
    ldh a, [$d7]
    ld hl, wEntity0PosX
    add  hl, de
    ld   [hl], a
    ldh a, [$d8]
    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   [hl], a
    ld   hl, $C450
    add  hl, de
    ld   [hl], $80
    ld hl, wEntitiesUnknowTableF
    add  hl, de
    ld   [hl], $18
    ld   hl, $C480
    add  hl, de
    ld   [hl], $03
    ldh  a, [$FFF9]
    and  a
    jr   nz, label_D6D9
    ld   hl, $C3A0
    add  hl, de
    ld   a, [hl]
    cp   $30
    jr   nz, label_D6B8
    ldh  a, [$FFEB]
    cp   $88
    jr   nz, label_D6B8
    ld   hl, $C3B0
    add  hl, de
    ld   [hl], $03

label_D6B8::
    cp   $3C
    jr   nz, label_D6D1

    ldh a, [hMapIndex]
    cp   $58
    jr   z, label_D6C6
    cp   $5A
    jr   nz, label_D6D1

label_D6C6::
    push bc
    push de
    ld   c, e
    ld   b, d
    ld   a, $10
    call label_FEC7
    pop  de
    pop  bc

label_D6D1::
    ld   hl, $C320
    add  hl, de
    ld   [hl], $18
    jr   label_D6DF

label_D6D9::
    ld   hl, $C250
    add  hl, de
    ld   [hl], $EC

label_D6DF::
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C310
    add  hl, de
    ld   [hl], a
    ret

data_D6EA::
    db 1, 8, 8, $10

data_D6EE::
    db 1, 4, 4

data_D6F1::
    db $A, $37, $37, $37, 1, $39, $39, $39, 1, $3B, $3B, $3B, 1, $3D, $3D, $3D

data_D701::
    db 1, $10, $10, 8, 0, $F0, $F0, $F8, 0, 0, 0, 0, 0, $FF, $FF, $FF

data_D711::
    db $FF, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8

data_D721::
    db 0, 0, 0, 8, $E, 0, 0, 8, $E, 0, 0, 8, $E, 0, 0, 0
    db $E

label_D732::
    ldh  a, [$FFEB]
    ld   [$C5A8], a
    cp   $02
    jr   nz, label_D745
    ld   hl, $C420
    add  hl, bc
    ld   [hl], b
    call label_E711
    jr   label_D748

label_D745::
    call label_3A81

label_D748::
    ld   hl, $C490
    add  hl, bc
    ld   a, [hl]
    ld   e, a
    ld   d, b
    cp   $04
    jr   z, label_D789
    ld   a, [$C15D]
    ldh  [$FF9E], a
    push hl
    call IsEntityFrameCounterZero
    pop  hl
    and  a
    jr   nz, label_D789
    inc  [hl]
    ld   hl, data_D6EA
    ldh  a, [$FFEB]
    cp   $02
    jr   z, label_D77F

    ld a, [wPowerBraceletLevel]
    cp   $02
    jr   nc, label_D77F

    ld a, [wTunicType]
    and  $01
    jr   nz, label_D77F
    ld   a, [wActivePowerUp]
    cp   $01
    jr   nz, label_D782

label_D77F::
    ld   hl, data_D6EE

label_D782::
    add  hl, de
    ld   a, [hl]
    ld hl, wEntitiesFrameCounterTable
    add  hl, bc
    ld   [hl], a

label_D789::
    ld   a, e
    cp   $00
    jr   nz, label_D78F
    inc  e

label_D78F::
    call label_D795
    jp   label_D7E6

label_D795::
    ldh  a, [$FF9E]
    sla  a
    sla  a
    add  a, e
    ld   e, a
    ld   d, $00
    ld   hl, data_D6F1
    add  hl, de
    ld   a, [hl]
    ld   [$C15C], a
    ld   hl, data_D701
    add  hl, de
    ld   a, [hl]
    ld hl, hLinkPositionX
    add [hl]
    ld hl, wEntity0PosX
    add  hl, bc
    ld   [hl], a
    ld   hl, data_D711
    add  hl, de
    ld   a, [hl]
    ld hl, hLinkPositionY
    add [hl]
    ld hl, $c13b
    add [hl]
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   [hl], a
    ldh  a, [$FFF9]
    and  a
    jr   z, label_D7D7
    push hl
    ld   hl, data_D721
    add  hl, de
    ld   e, [hl]
    pop  hl
    ld   a, [hl]
    sub  a, e
    ld   [hl], a
    ret

label_D7D7::
    ld   hl, data_D721
    add  hl, de
    ld   a, [hl]
    ld   hl, $FFA2
    add  a, [hl]
    ld   hl, $C310
    add  hl, bc
    ld   [hl], a
    ret

label_D7E6::
    jp   label_397B

label_D7E9::
    ld   de, data_D7FB
    ld a, [wGameplayType]
    cp   $01
    jr   z, label_D7F7
    ld   a, $30
    ldh  [$FFF5], a

label_D7F7::
    call label_D83C
    ret

data_D7FB::
    db $30, 2, $30, $22

data_D7FF::
    db $32, 2, $32, $22, $30, $42, $30, $62, $32, $42, $32, $62, $34, 2, $36, 2
    db $38, 2, $3A, 2

data_D813::
    db $36, $22, $34, $22, $3A, $22, $38, $22

data_D81B::
    db 8, $F8, 0, 0

data_D81F::
    db 0, 0

data_D821::
    db $F8, 8

data_D823::
    ld   b, $04
    ld   [bc], a
    nop
    ldh a, [hMapTileset]
    cp   $15
    jr   nz, label_D835

    ld a, [wIsBowWowFollowingLink]
    cp   $80
    jp   nz, label_3F8D

label_D835::
    ld   a, c
    ld   [$D153], a
    ld   de, data_D917

label_D83C::
    call label_3BC0
    call label_FF78
    ld   hl, $C410
    add  hl, bc
    ld   a, [hl]

label_D847::
    and  a
    jr   z, label_D858

    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   a, $01
    ld   [hl], a
    ldh  [$FFF0], a
    call IsEntityFrameCounterZero
    ld   [hl], $40

label_D858::
    call label_FFA9
    call label_EE28
    ldh  a, [$FFF0]
    and  a
    jr   z, label_D8D7
    call IsEntityFrameCounterZero
    jr   z, label_D896
    cp   $0A
    jr   nz, label_D889
    call label_C00
    jr   nz, label_D889
    call label_FEFE
    ld   hl, $C380
    add  hl, bc
    ld   a, e
    cp   [hl]
    jr   nz, label_D889
    ldh  a, [$FFEB]
    cp   $24
    jr   z, label_D889
    cp   $09
    jr   z, label_D88D
    call label_D947

label_D889::
    call label_F893
    ret

label_D88D::
    ld a, [wGameplayType]
    cp   $01
    ret  z
    jp   label_D998

label_D896::
    call GetRandomByte
    and  $1F
    or   $20
    ld   [hl], a
    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   [hl], $00
    ld hl, wEntitiesUnknownTableB
    add  hl, bc
    ld   a, [hl]
    inc  a
    and  $03
    ld   [hl], a
    cp   $00
    jr   nz, label_D8B6
    call label_FEFE
    jr   label_D8B9

label_D8B6::
    call GetRandomByte

label_D8B9::
    and  $03
    ld   hl, $C380
    add  hl, bc
    ld   [hl], a
    ld   e, a
    ld   d, b
    ld   hl, data_D81B
    add  hl, de
    ld   a, [hl]
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    ld   hl, data_D81F
    add  hl, de
    ld   a, [hl]
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a
    ret

label_D8D7::
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   a, [hl]
    and  $0F
    jr   nz, label_D8E5
    call IsEntityFrameCounterZero
    jr   nz, label_D8F6

label_D8E5::
    call GetRandomByte
    and  $0F
    or   $10
    ld   [hl], a
    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   [hl], $01
    call label_3D7F

label_D8F6::
    call label_FF25
    call label_F893

label_D8FC::
    ld   hl, $C380
    add  hl, bc
    ld   e, [hl]
    ld   d, b
    ld   hl, data_D823
    add  hl, de
    push hl
    ld   hl, $C3D0
    add  hl, bc
    inc  [hl]
    ld   a, [hl]
    rra
    rra
    rra
    pop  hl
    and  $01
    or   [hl]
    jp   label_3B0C

data_D917::
    ld   h, b
    inc  bc
    ld   h, d
    inc  bc
    ld   h, d
    inc  hl
    ld   h, b
    inc  hl
    ld   h, h
    inc  bc

label_D921::
    ld   h, [hl]
    inc  bc
    ld   h, [hl]
    inc  hl
    ld   h, h
    inc  hl
    ld   l, b
    inc  bc
    ld   l, d
    inc  bc
    ld   l, h
    inc  bc
    ld   l, [hl]
    inc  bc
    ld   l, d
    inc  hl
    ld   l, b
    inc  hl
    ld   l, [hl]
    inc  hl
    ld   l, h
    inc  hl

data_D937::
    db 8, $F8, 4, $FC

data_D93B::
    db $FC, $FC, $F8, 0

data_D93F::
    db $20, $E0, 0, 0

data_D943::
    db 0, 0, $E0, $20

label_D947::
    ld   a, $0C
    call label_E4CA
    jr   c, label_D98B
    push bc
    ldh  a, [$FFD9]
    ld   c, a
    ld   hl, data_D937
    add  hl, bc
    ldh a, [$d7]
    add [hl]
    ld hl, wEntity0PosX
    add  hl, de
    ld   [hl], a
    ld   hl, data_D93B
    add  hl, bc
    ldh a, [$d8]
    add [hl]
    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   [hl], a
    ld   hl, data_D93F
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C240
    add  hl, de
    ld   [hl], a

label_D974::
    ld   hl, data_D943
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C250
    add  hl, de
    ld   [hl], a
    ldh  a, [$FFD9]
    ld   hl, $C3B0
    add  hl, de
    ld   [hl], a
    ld   hl, $C380
    add  hl, de
    ld   [hl], a
    pop  bc

label_D98B::
    ret

data_D98C::
    db 8, $F8

data_D98E::
    db 0, 0, $F8, 8

data_D992::
    jr   nz, label_D974

data_D994::
    nop
    nop
    ld   [rNR41], a

label_D998::
    ld   a, $0A
    call label_E4CA
    jr   c, label_D9D6
    push bc
    ldh  a, [$FFD9]
    ld   hl, $C380
    add  hl, de
    ld   [hl], a
    ld   c, a
    ld   hl, data_D98C
    add  hl, bc
    ldh a, [$d7]
    add [hl]
    ld hl, wEntity0PosX
    add  hl, de
    ld   [hl], a
    ld   hl, data_D98E
    add  hl, bc
    ldh a, [$d8]
    add [hl]
    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   [hl], a
    ld   hl, data_D992
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C240
    add  hl, de
    ld   [hl], a
    ld   hl, data_D994
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C250
    add  hl, de
    ld   [hl], a
    pop  bc
    and  a

label_D9D6::
    ret
    ret

; Data for heart container sprite
data_D9D8::
    db $AA, $14, $AA, $34

; Loop run every frame heart container is on screen
LoadHeartContainer:: ; 03:59DC
    ld   de, data_D9D8
    call label_3BC0
    call IsEntityFrameCounterZero
    jp   z, label_E0AA
    ; Start of when item is picked up
    dec  a
    jr   nz, label_DA17
    ld   a, $18
    ld [wWorldMusicTrack], a
    ; Increase max hearts when picking up heart container
    ld hl, wMaxHearts
    inc  [hl]
    ld   hl, wSubstractRupeeBufferLow
    ld   [hl], $FF
    call label_D134
    ld   a, [hl]
    or   $20
    ld   [hl], a
    ldh [hFFF8], a
    ldh a, [hMapTileset]
    ld hl, $da2e
    cp   $06
    jr   z, label_DA12
    cp   $03
    jr   nz, label_DA14
    ld   hl, $D966

label_DA12::
    set  5, [hl]

label_DA14::
    jp   label_3F8D

label_DA17::
    ldh a, [hLinkPositionX]
    ld hl, wEntity0PosX
    add  hl, bc
    ld   [hl], a
    ldh a, [hLinkPositionY]
    ld hl, wEntitiesPosYTable
    add  hl, bc
    sub  a, $0C
    ld   [hl], a
    ldh  a, [$FFA2]
    ld   hl, $C310
    add  hl, bc
    ld   [hl], a
    ld a, $6c
    ldh [hLinkAnimationState], a
    ld   a, $03
    ldh  [$FF9E], a
    xor  a
    ld [$c137], a
    ld [wC16A], a
    ld [$c122], a
    ld [wIsUsingSpinAttack], a
    ld hl, $c470
    add  hl, bc
    ld   [hl], a
    ld   a, $02
    ldh  [$FFA1], a
    ret

data_DA4D::
    xor  h
    ld   [bc], a
    xor  h
    ldi  [hl], a
    ldh  a, [$FFF8]
    and  $10
    jp   nz, label_3F8D
    ldh  a, [$FFF0]
    rst  0
    ld   d, d
    ld   e, e
    ld   l, l
    ld   e, d
    ld   a, h
    ld   e, d
    add  a, e
    ld   e, d
    adc  a, d
    ld   e, d
    sbc  a, b
    ld   e, d
    cp   e
    ld   e, d
    ld   a, [$FF5A]
    dec  b
    ld   e, e
    call label_DA17
    call IsEntityFrameCounterZero
    ret  nz
    ld   a, $01
    ld   [$C167], a
    jp   IncrementEntityWalkingAttr
    ld   a, $03
    ldh [hNeedsUpdatingBGTiles], a
    jp   IncrementEntityWalkingAttr
    ld   a, $04
    ldh [hNeedsUpdatingBGTiles], a
    jp   IncrementEntityWalkingAttr
    ld   a, $4F
    call label_2385
    call IncrementEntityWalkingAttr
    ld   a, $01
    ld   [$C1AB], a
    ret
    call label_DA17
    ld   de, data_DA4D
    call label_3BC0
    call label_DB2B
    ld   hl, $C3D0
    add  hl, bc
    inc  [hl]
    ld   a, [hl]
    cp   $A8
    jp   z, IncrementEntityWalkingAttr
    cp   $38
    jr   nz, label_DABA
    ld   a, [$DB5C]
    inc  a
    ld   [$DB5C], a

label_DABA::
    ret
    call label_DA17
    ld   de, data_DA4D
    call label_3BC0
    xor  a
    ld   [$C1AB], a
    call label_DB2B
    ld a, [wDialogState]
    and  a
    ret  nz
    ld   a, [$DB5C]
    cp   $04
    jr   nz, label_DAED
    ld   a, $19
    ldh  [$FFF2], a
    xor  a
    ld   [$DB5C], a
    ld   hl, wSubstractRupeeBufferLow
    ld   [hl], $40
    ld   hl, $DB5B
    inc  [hl]
    ld   a, $50
    call label_2385

label_DAED::
    jp   IncrementEntityWalkingAttr
    call label_DA17
    ld   de, data_DA4D
    call label_3BC0
    ld a, [wDialogState]
    and  a
    ret  nz
    ld   a, $05
    ldh [hNeedsUpdatingBGTiles], a
    jp   IncrementEntityWalkingAttr
    ld   a, $06
    ldh [hNeedsUpdatingBGTiles], a
    call label_3F8D
    ld   a, $0D
    ldh  [$FFA5], a
    xor  a
    ld   [$C167], a
    jp   label_D12A

data_DB17::
    sbc  a, d
    ld   [bc], a
    sbc  a, d
    ldi  [hl], a
    sbc  a, h
    ld   [bc], a
    sbc  a, d
    ldi  [hl], a
    sbc  a, [hl]
    ld   [bc], a
    sbc  a, d
    ldi  [hl], a
    sbc  a, [hl]
    ld   [bc], a
    sbc  a, h
    ldi  [hl], a
    sbc  a, [hl]
    ld   [bc], a
    sbc  a, [hl]
    ldi  [hl], a

label_DB2B::
    ld a, [wDialogState]
    and  a
    ret  z

    ld a, [wDialogCharacterIndex]
    cp   $21
    ret  nc

    ld a, [wDialogState]
    and  $80
    ld   a, $23
    jr   z, label_DB41
    ld   a, $6B

label_DB41::
    ldh  [$FFEC], a
    ld   a, [$DB5C]
    ldh  [$FFF1], a
    ld   a, $8E
    ldh  [$FFEE], a
    ld   de, data_DB17
    jp   label_3BC0
    ld   de, data_DA4D
    call label_3BC0
    jp   label_E0AA

data_DB5B::
    db $AE, $14

label_DB5D::
    ld   de, data_DB5B
    call label_3C77
    jr   label_DB7D

data_DB65::
    db $14, 2, $14

data_DB68::
    db $22, $14, $14

data_DB6B::
    db $14, $34

label_DB6D::
    ld   de, data_DB65
    call label_3BC0
    ldh a, [hFrameCounter]
    rra
    rra
    rra
    and  $01
    call label_3B0C

label_DB7D::
    jp   label_E0AA

data_DB80::
    db $74, 0, $76, 0, $76, $20, $74, $20, $11, $80, $5B, $CD, $C0, $3B, $CD, $78
    db $7F, $CD, $AF, $62, $C9

data_DB95::
    db $86, $17

data_DB97::
    db $84, $17

label_DB99::
    ld   de, data_DB95
    ld a, [wDidFindSword]
    and  a
    jr   nz, label_DBAC
    ldh  a, [$FFF8]
    and  $10
    jp   nz, label_3F8D
    ld   de, data_DB97

label_DBAC::
    call label_3C77
    ldh  a, [$FFF0]
    rst  0

label_DBB2::
    db $BA, $5B, $E4, $5B, 1, $5C, $F, $5C

label_DBBA::
    call IsEntityFrameCounterZero
    jp   z, label_E0AA
    cp   $10
    jr   nz, label_DBCB
    dec  [hl]
    ld   a, $9B
    call label_2385
    xor  a

label_DBCB::
    dec  a
    jr   nz, label_DBE1
    ld   a, $31
    ld [wWorldMusicTrack], a
    ld   a, $05
    ldh  [$FFB0], a
    ldh  [$FFBF], a
    call label_BFB
    ld   [hl], $52
    call IncrementEntityWalkingAttr

label_DBE1::
    jp   label_DA17
    call label_DA17
    call label_BFB
    ret  nz
    ld   a, $FF
    call label_3B0C
    call IsEntityFrameCounterZero
    ld   [hl], $20
    ld   a, $20
    ld [wIsUsingSpinAttack], a
    ld   a, $03
    ldh  [$FFF4], a
    jp   IncrementEntityWalkingAttr
    call IsEntityFrameCounterZero
    ret  nz
    ld   [hl], $20
    ld   a, $00
    call label_3B0C
    jp   IncrementEntityWalkingAttr
    call label_DA17
    ld a, $6b
    ldh [hLinkAnimationState], a
    ld hl, wEntity0PosX
    add  hl, bc
    ldh a, [hLinkPositionX]
    sub $04
    ld   [hl], a
    call IsEntityFrameCounterZero
    jr   nz, label_DC37
    ld   [$C167], a
    ld   d, $01
    call AddItemToInventory
    ld   a, $01
    ld   [wDidFindSword], a
    call label_D12A
    jp   label_3F8D

label_DC37::
    cp   $1A
    jr   nz, label_DC46
    ldh  a, [$FFEF]
    sub  a, $0C
    call label_EC36
    ld   a, $07
    ldh  [$FFF2], a

label_DC46::
    ret

data_DC47::
    db $8A, $14

label_DC49::
    ldh  a, [$FFF8]
    and  $10
    jp   nz, label_3F8D
    ld   de, data_DC47
    call label_3C77
    call IsEntityFrameCounterZero
    jp   z, label_E0AA
    cp   $10
    jr   nz, label_DC67
    dec  [hl]
    ld   a, $93
    call label_2385
    xor  a

label_DC67::
    dec  a
    jr   nz, label_DC75
    ld   d, $06
    call AddItemToInventory
    call label_D12A
    jp   label_3F8D

label_DC75::
    jp   label_DA17

data_DC78::
    db $CA, $17, $C0, $17, $C2, $14, $C4, $17, $C6, $14, $CA, $17

data_DC84::
    db 0, $A3, $A4, $A5, 0

label_DC89::
    call label_DCEA
    jr   nc, label_DC99
    ld   hl, $D8CE
    set  4, [hl]
    ld   hl, $D9F8
    set  5, [hl]
    ret

label_DC99::
    ldh a, [hMapIndex]
    cp   $80
    jp   z, label_DC49
    ld   de, data_DC78
    call label_3C77
    call IsEntityFrameCounterZero
    jp   z, label_DCD6
    cp   $10
    jr   nz, label_DCCD
    dec  [hl]
    ldh  a, [$FFF1]
    dec  a
    ld   e, a
    ld   d, b
    ld   hl, data_DC84
    add  hl, de
    ld   a, [hl]
    call label_2385
    ldh  a, [$FFF1]
    dec  a
    ld   e, a
    ld   d, b
    ld hl, wHasTailKey
    add  hl, de
    ld   [hl], $01
    call label_D12A
    xor  a

label_DCCD::
    dec  a
    jr   nz, label_DCD3
    jp   label_3F8D

label_DCD3::
    jp   label_DA17

label_DCD6::
    call label_FF78
    call label_E2AF
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   nz, label_DCE7
    call label_E2EB

label_DCE7::
    jp   label_E0B3

label_DCEA::
    ld a, [wActiveRoom]
    and  a
    jr   nz, label_DD34

    ldh a, [hMapIndex]
    cp $ce
    jr   nz, label_DD34
    ldh  a, [$FFEF]
    sub  a, $48
    add  a, $03
    cp   $06
    jr   nc, label_DD34
    ldh  a, [$FFEE]
    sub  a, $50
    add  a, $03
    cp   $06
    jr   nc, label_DD34
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   nz, label_DD34

    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   a, [hl]
    cp   $05
    jr   nz, label_DD34
    ld   [hl], $02
    ld   hl, $C4B0
    add  hl, bc
    ld   [hl], $50
    ld   hl, $C4C0
    add  hl, bc
    ld   [hl], $48
    call IsEntityFrameCounterZero
    ld   [hl], $2F
    ld   a, $18
    ldh  [$FFF2], a
    scf
    ret

label_DD34::
    and  a
    ret

data_DD36::
    db $A8, $14

label_DD38::
    call label_E1DE
    call label_E08C
    ld   de, data_DD36
    call label_3C77
    jp   label_E0AA

data_DD47::
    db $5E, 2, $5E, $22

label_DD4B::
    ld   hl, $DB4B
    ld   a, [$DB4C]
    or   [hl]
    jp   nz, label_3F8D
    ld   de, data_DD47
    call label_3BC0
    call IsEntityFrameCounterZero
    jp   z, label_E0AA
    cp   $10
    jr   nz, label_DD6C
    dec  [hl]
    ld   a, $0F
    call label_2385
    xor  a

label_DD6C::
    dec  a
    jr   nz, label_DD80
    ld   a, $0A
    ldh  [$FFA5], a
    ld   d, $0C
    call AddItemToInventory
    ld   a, $01
    ld   [$DB4B], a
    jp   label_3F8D

label_DD80::
    jp   label_DA17

data_DD83::
    db $70, 1, $72, 1, $74, 1, $76, 1, $78, 1, $7A, 1, $7C, 1, $7E, 1
    db $21, $B0, $C2, 9, $7E, $C7, $A3, $5E, $93, $5E, $D9, $5D

data_DD9F::
    db $E4, $E4, $E4, $E4, $90, $90, $90, $90, $40, $40, $40, $40, 0, 0, 0, 0
    db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0

data_DDBC::
    db $1C, $1C, $1C, $1C, $1C, $1C, $1C, $1C, $1C, $1C, $1C, $1C, $1C, $1C, $1C, $1C
    db 8, 8, 8, 8, 4, 4, 4, 4, 0, 0, 0, 0, 0, $CD, $76, $3E
    db $3E, 1, $EA, $67, $C1, $CD, $FB, $B, $20, $43, $CD, $8D, $3F, $AF, $E0, $9D
    db $FA, 1, $D2, $5F, $50, $21, $90, $C2, $19, $34, $CD, $9E, $C, $F0, $F7, $C7
    db $C, $5E, $12, $5E, $18, $5E, $19, $5E, $1E, $5E, $1F, $5E, $24

label_DE09::
    ld   e, [hl]
    ld   e, $5E
    ld   a, $80
    ld [wIsBowWowFollowingLink], a
    ret

label_DE12::
    ld   a, $02
    ld   [$DB48], a
    ret

label_DE18::
    ret

label_DE19::
    ld   a, $02
    ld [wIsGhostFollowingLink], a
    ret

label_DE1F::
    xor  a
    ld   [$DB74], a
    ret

label_DE24::
    xor  a
    ld [wIsRoosterFollowingLink], a
    ret

label_DE29::
    cp   $50
    jr   nc, label_DE8A

    ld hl, wEntitiesUnknownTableC
    add  hl, bc
    ld   a, [hl]
    cp   $19
    jr   nc, label_DE8A

    ldh a, [hFrameCounter]
    and  $07
    jr   nz, label_DE5B
    ld   a, [hl]
    and  a
    jr   nz, label_DE45
    ld   a, $2C
    ldh  [$FFF4], a
    xor  a

label_DE45::
    inc  [hl]
    cp   $18
    jr   nz, label_DE5B
    ld   a, $9F
    call label_E4CA
    ld hl, wEntitiesUnknownTableB
    add  hl, de
    ld   [hl], $01
    ld hl, wEntitiesFrameCounterTable
    add  hl, de
    ld   [hl], $60

label_DE5B::
    ldh a, [hFrameCounter]
    and  $03
    ld hl, wEntitiesUnknownTableC
    add  hl, bc
    add  a, [hl]
    ld   e, a
    ld   d, b
    ldh a, [hIsGBC]
    and  a
    jr   z, label_DE76
    push bc
    push de
    ld   a, $03
    call label_978
    pop  de
    pop  bc
    jr   label_DE8A

label_DE76::
    ld   hl, data_DD9F
    add  hl, de
    ld   a, [hl]
    ld [wBGPalette], a
    ld   hl, data_DDBC
    add  hl, de
    ld   a, [hl]
    ld [wOBJ0Palette], a
    xor  a
    ld [wOBJ1Palette], a

label_DE8A::
    ret

label_DE8B::
    db $6C, 0, $FF, $FF, $6C, 0, $6E, 0, $11, $8B, $5E, $CD, $C0, $3B, $CD, $25
    db $7F, $CD, 5, $C, $CA, $8D, $3F, $C9, $F0, $F0, $FE, 3, $30, 5, $3E, 3
    db $CD, $D2, $A

label_DEAE::
    ld   a, c
    ld   [$D201], a
    ldh  a, [$FFF8]
    and  $10
    jp   nz, label_3F8D

    ldh a, [hMapTileset]
    and  $03
    ldh  [$FFF1], a
    call label_394D
    ld   de, data_DD83
    call label_3BC0
    ldh  a, [$FFF0]
    rst  0
    push de
    ld   e, [hl]
    inc  c
    ld   e, a
    inc  sp
    ld   e, a
    cp   h
    ld   e, a
    cp   a
    ld   e, a
    call IsEntityFrameCounterZero
    jp   z, label_E0AA
    cp   $10
    jr   nz, label_DEFE
    dec  [hl]
    call IncrementEntityWalkingAttr
    ldh a, [hMapTileset]
    add $00
    call label_2373
    ldh a, [hMapTileset]
    ld   e, a
    ld   d, b
    ld hl, wHasInstrument1
    add  hl, de
    ld   a, [hl]
    or   $02
    ld   [hl], a
    call label_D134
    ld   a, [hl]
    or   $10
    ld   [hl], a
    xor  a

label_DEFE::
    dec  a
    jr   nz, label_DF01

label_DF01::
    jp   label_DA17

data_DF04::
    db $20, $28, $29, $2A, $2B, $2C, $2D, $2E, $FA, $69, $D3, $A7, $20, $1A, $FA, $9F
    db $C1, $A7, $20, $14, $F0, $F7, $5F, $50, $21, 4, $5F, $19, $7E, $EA, $68, $D3
    db $CD, $12, $3B, $CD, 5, $C, $36, $FF

label_DF2C::
    jp   label_DA17

data_DF2F::
    db $A, $FA

data_DF31::
    db 4, $FC

label_DF33::
    call IsEntityFrameCounterZero
    jr   nz, label_DF5F
    ld   a, $2B
    ldh  [$FFF2], a
    ld   a, $39
    call label_E4CA
    ldh  a, [$FFD7]
    dec  a
    ld hl, wEntity0PosX
    add  hl, de
    ld   [hl], a
    ldh a, [$d8]
    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   [hl], a
    ld hl, wEntitiesUnknownTableB
    add  hl, de
    ld   [hl], $02
    ld   hl, $C450
    add  hl, de
    ld   [hl], $80
    jp   IncrementEntityWalkingAttr

label_DF5F::
    ld hl, wEntitiesUnknownTableD
    add  hl, bc
    dec  [hl]
    ld   a, [hl]
    cp   $FF
    jr   nz, label_DFB9
    ld   [hl], $17
    ld   hl, $C440
    add  hl, bc
    inc  [hl]
    ld   a, [hl]
    and  $01
    ldh  [$FFE8], a
    ld   a, $39
    call label_E4CA
    push bc
    ld hl, wEntitiesUnknownTableB
    add  hl, de
    inc  [hl]
    ldh  a, [$FFE8]
    ld   c, a
    ld   hl, data_DF2F
    add  hl, bc
    ldh a, [$d7]
    add [hl]
    ld hl, wEntity0PosX
    add  hl, de
    ld   [hl], a
    ld   hl, data_DF31
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C240
    add  hl, de
    ld   [hl], a
    ldh a, [$d8]
    ld hl, wEntitiesPosYTable
    add  hl, de
    add  a, $F8
    ld   [hl], a
    ld   hl, $C250
    add  hl, de
    ld [hl], $fd
    ld hl, wEntitiesFrameCounterTable
    add  hl, de
    ld   [hl], $38
    call GetRandomByte
    and  $01
    ld   hl, $C3B0
    add  hl, de
    ld   [hl], a
    pop  bc

label_DFB9::
    jp   label_DA17
    jp   label_DA17
    ret

data_DFC0::
    db $80, $15

label_DFC2::
    call label_E1DE
    call label_E08C
    ld   de, data_DFC0
    call label_3C77
    jp   label_E0AA

; Data for loading secret seashell when bush is clipped (and when dug from ground) (at least first 2 bytes)
data_DFD1::
    db $9E, $14

; Start of code for secret seashell
label_003_5FD3::
    ld a, [wDidFindSword]
    cp $02
    jp nc, label_3F8D
    ldh [hFFF8]
    and a, $10
    jp nz, label_3F8D
    ldh a, [hMapIndex]
    cp a, $E3
    jr nz, label_DFEF
    ldh a, [hFFF8]
    and a, $40
    jp z, label_3F8D

label_DFEF::
    call label_E1DE
    ld   de, data_DFD1
    call label_3C77
    jp   label_E0AA

data_DFFB::
    db $CA, $14, $F0, $F8, $E6, $10

label_E001::
    jp   nz, label_3F8D
    call label_E1DE
    ld   de, data_DFFB
    call label_3C77
    call IsEntityFrameCounterZero
    jp   z, label_E0AA
    cp   $10
    jr   nz, label_E04C
    dec  [hl]
    ld a, [wActiveRoom]
    and  a
    jr   nz, label_E029

    ldh a, [hMapIndex]
    cp $c6
    jr   nz, label_E029
    ld   a, $05
    ld [wGoldenLeavesCount], a

label_E029::
    ld hl, wGoldenLeavesCount
    call label_E373
    call label_D12A
    ld   hl, $FFF8
    res  4, [hl]
    ld e, $a2
    ld a, [wGoldenLeavesCount]
    cp   $06
    jr   z, label_E047
    ld   e, $E8
    cp   $05
    jr   nz, label_E047
    inc  e

label_E047::
    ld   a, e
    call label_2385
    xor  a

label_E04C::
    dec  a
    jr   nz, label_E052
    jp   label_3F8D

label_E052::
    jp   label_DA17

label_E055::
    adc  a, [hl]
    ld   d, $FA
    and  l
    db   $DB
    and  a
    jr   z, label_E063

    ldh a, [hMapTileset]
    cp $ff
    jr   z, label_E06A

label_E063::
    ld   a, [$DB4B]
    and  a
    jp   nz, label_3F8D

label_E06A::
    call label_E1DE
    call label_E08C
    ld   de, label_E055
    call label_3C77
    jp   label_E0AA

label_E079::
    ld   a, [hli]
    ld   b, c
    ld   a, [hli]
    ld   h, c
    call label_E1DE
    call label_E08C
    ld   de, label_E079
    call label_3BC0
    jp   label_E0AA

label_E08C::
    call label_BFB
    cp   $1C
    ret  nc
    and  a
    jp   z, label_3F8D
    and  $01
    dec  a
    jp   label_3B0C

label_E09C::
    and  [hl]
    dec  d
    call label_E1DE
    call label_E08C
    ld   de, label_E09C
    call label_3C77

label_E0AA::
    call label_FF78
    call label_E2AF
    call label_E2EB

label_E0B3::
    call label_FF25
    call label_EB7B
    call label_F893
    ldh  a, [$FFF9]
    and  a
    jr   z, label_E0E3

    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   a, [hl]
    and  $08
    jp   z, label_E156

    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    and  $F0
    add  a, $05
    ld   [hl], a
    ld   hl, $C250
    add  hl, bc
    ld   a, [hl]
    cpl
    sra  a
    cp   $F8
    jr   c, label_E112
    jr   label_E103

label_E0E3::
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    and  $80
    jr   z, label_E156
    xor  a
    ld   [hl], a
    ld   hl, $C470
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C320
    add  hl, bc
    cp   $02
    jr   z, label_E103
    ld   a, [hl]
    sra  a
    cpl
    cp   $07
    jr   nc, label_E112

label_E103::
    xor  a
    push hl
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a
    pop  hl
    jr   label_E136

label_E112::
    push af
    push hl
    ldh  a, [$FFEB]
    cp   $30
    jr   nz, label_E120
    ld   a, $17
    ldh  [$FFF4], a
    jr   label_E134

label_E120::
    cp   $02
    jr   nz, label_E134

    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_E134
    cp   $02
    jr   z, label_E134
    ld   a, $09

label_E132::
    ldh  [$FFF2], a

label_E134::
    pop  hl
    pop  af

label_E136::
    ld   [hl], a
    ld   hl, $C240
    add  hl, bc
    ld   a, [hl]
    sra  a
    cp   $FF
    jr   nz, label_E143
    xor  a

label_E143::
    ld   [hl], a
    ldh  a, [$FFF9]
    and  a
    jr   nz, label_E156
    ld   hl, $C250
    add  hl, bc
    ld   a, [hl]
    sra a
    cp $ff
    jr nz, label_E155
    xor  a

label_E155::
    ld   [hl], a

label_E156::
    ret

label_E157::
    db $20, $21, $20, 1, $CD, $DE, $61, $CD, $8C, $60, $11, $57, $61, $CD, $77, $3C
    db $CD, $78, $7F, $CD, $AF, $62, $CD, $EB, $62, $21, $40, $C2, 9, $7E, 7, $E6
    db 1, $CD, $C, $3B, $CD, $25, $7F, $CD, $C0, $61, $CD, $93, $78, $CD, $D9, $7E
    db $7A, $CB, $7F, $28, 0

label_E18C::
    cp   $20
    jr   c, label_E19C
    call label_FEE9
    ld   a, d
    bit  7, a
    jr   z, label_E198

label_E198::
    cp   $20
    jr   nc, label_E1BB

label_E19C::
    call IsEntityFrameCounterZero
    ret  nz
    ld   [hl], $30
    call GetRandomByte
    and  $0F
    sub  a, $08
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    call GetRandomByte
    and  $0F
    sub  a, $08
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a
    ret

label_E1BB::
    ld   a, $09
    jp   label_FEC7

label_E1C0::
    ldh a, [hFrameCounter]
    and  $03
    jr   nz, label_E1DD
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    cp   $10
    jr   z, label_E1DD
    bit  7, a
    jr   z, label_E1D6
    inc  [hl]
    jr   label_E1DD

label_E1D6::
    cp   $10
    jr   nc, label_E1DC
    inc  [hl]
    ret

label_E1DC::
    dec  [hl]

label_E1DD::
    ret

label_E1DE::
    ld hl, wEntitiesUnknownTableD
    add  hl, bc
    ld   a, [hl]
    and  a
    jp   z, label_E29D

    ld a, [wMapSlideTransitionState]
    and  a
    jp   nz, label_E29C
    ld   a, [hl]
    cp   $02
    jr   nz, label_E243
    ldh  a, [$FFEB]
    cp   $3D
    jr   z, label_E200

    ld a, [wActiveRoom]
    and  a
    jp   nz, label_E29C

label_E200::
    call label_FE0E
    ldh  a, [$FFEB]
    cp   $2D
    jr   z, label_E227
    cp   $3D
    jr   nz, label_E22F

    ldh a, [hMapIndex]
    cp $da
    jr   z, label_E22F
    cp   $A5
    jr   z, label_E22F
    cp   $74
    jr   z, label_E22F
    cp   $3A
    jr   z, label_E22F
    cp   $A8
    jr   z, label_E22F
    cp   $B2
    jr   z, label_E22F

label_E227::
    ldh  a, [$FFAF]
    cp   $04
    jr   z, label_E23B
    jr   label_E235

label_E22F::
    ld   hl, $C440
    add  hl, bc
    ld   [hl], $01

label_E235::
    ldh  a, [$FFAF]
    cp   $CC
    jr   nz, label_E29C

label_E23B::
    ld   hl, $C430
    add  hl, bc
    ld   [hl], $0A
    jr   label_E26B

label_E243::
    ld   a, [$C157]
    and  a
    jr   z, label_E29C
    ld   a, [$C178]
    and  a
    jr   z, label_E29C
    ldh  a, [$FFEE]
    add  a, $08
    ld   hl, $C179
    sub  a, [hl]
    add  a, $10
    cp   $20
    jr   nc, label_E29C
    ldh  a, [$FFEF]
    add  a, $08
    ld   hl, $C17A
    sub  a, [hl]
    add  a, $10
    cp   $20
    jr   nc, label_E29C

label_E26B::
    ld hl, wEntitiesUnknownTableD
    add  hl, bc
    ld   [hl], b
    ld   hl, $C440
    add  hl, bc
    ld   [hl], b
    call label_C00
    ld   [hl], $18
    ld   a, $0C
    call label_FE45
    ldh  a, [$FFD8]
    cpl
    inc  a
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    ldh  a, [$FFD7]
    cpl
    inc  a
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a
    ld   hl, $C320
    add  hl, bc
    ld   [hl], $20
    call label_BFB
    ld   [hl], $80

label_E29C::
    pop  af

label_E29D::
    ret

data_E29E::
    db 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0
    db 0

label_E2AF::
    ld   hl, $C390
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_E2EA
    pop  de
    dec  a
    ld   e, a
    ld   d, b
    ld hl, wEntitiesTypeTable
    add  hl, de
    ld   a, [hl]
    and  a
    jr   z, label_E311
    ld   hl, $C3A0
    add  hl, de
    ld   a, [hl]
    cp   $01
    jr   z, label_E2D0
    cp   $03
    jr   nz, label_E311

label_E2D0::
    ld hl, wEntity0PosX
    add  hl, de
    ld   a, [hl]
    ld hl, wEntity0PosX
    add  hl, bc
    ld   [hl], a
    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   a, [hl]
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   [hl], a
    xor  a
    ld   hl, $C310
    add  hl, bc
    ld   [hl], a

label_E2EA::
    ret

label_E2EB::
    call label_C00
    jr   nz, label_E2EA
    ldh  a, [$FFEB]
    sub  a, $2D
    ld   e, a
    ld   d, b
    ld   hl, data_E29E
    add  hl, de
    ld   a, [hl]
    and  a
    jr   z, label_E30C
    ld   hl, $C410
    add  hl, bc
    ld   a, [hl]
    push af
    push hl
    ld   [hl], b
    call label_EE2B
    pop  hl
    pop  af
    ld   [hl], a

label_E30C::
    call label_EC6B
    jr   nc, label_E2EA

label_E311::
    ld   hl, $C460
    add  hl, bc
    ld   a, [hl]
    call label_3F78
    ldh  a, [$FFEB]
    sub  a, $2D
    cp   $02
    jr   nc, label_E328
    ld   hl, $FFF2
    ld   [hl], $14
    jr   label_E32D

label_E328::
    ld hl, hSFX
    ld   [hl], $01

label_E32D::
    rst  0
    or   a
    ld   h, h
    cp   a
    ld   h, h
    add  a, $64
    adc  a, a
    ld   h, h
    ld   c, l
    ld   h, h
    ld   c, h
    ld   h, h
    db   $FC ; Undefined instruction
    ld   h, e
    or   $63
    db   $E4 ; Undefined instruction
    ld   h, e
    or   b
    ld   h, e
    ld   a, l
    ld   h, e
    add  a, l
    ld   h, e
    sub  a, d
    ld   h, e
    rst  0
    ld   h, e
    ld   d, b
    ld   h, e
    rst  0
    ld   h, e
    ld   l, b
    ld   h, e
    ld   a, $0B
    ldh  [$FFA5], a
    ld   d, $0C
    call AddItemToInventory
    ld   hl, $DB76
    ld   de, $DB4C

label_E35F::
    ld   a, [de]
    cp   [hl]
    jr   nc, label_E367
    add  a, $01
    daa
    ld   [de], a

label_E367::
    ret
    ld   a, $EF
    call label_2385

; Increment seashell count
label_E36D::
    call label_D12A
    ld   hl, wSeashellsCount

label_E373::
    ld   a, [hl]
    cp   $99
    jr   z, label_E37C
    add  a, $01
    daa
	; Write new seashell value to seashells count
    ld   [hl], a

label_E37C::
    ret


    ld hl, $db78
    ld de, wArrowCount
    jr   label_E35F
    ld   d, $02
    call AddItemToInventory
    ld hl, $db77
    ld de, wBombCount
    jr   label_E35F
    xor  a
    ld   [wBossDefeated], a
    ld [$c3cb], a
    ld a, $1b
    ld [wWorldMusicTrack], a
    ld [wC167], a

label_E3A1::
    ldh a, [hLinkPositionX]
    push af
    add $04
    ldh [hLinkPositionX], a
    call label_E41E
    pop  af
    ldh [hLinkPositionX], a
    jr   label_E3D2
    xor  a
    ld   [wActivePowerUp], a
    ld   a, $25
    ld [wWorldMusicTrack], a
    ld   [wBossDefeated], a
    call IsEntityFrameCounterZero
    ld   a, $70
    ld   [hl], a
    ld   [$C111], a
    jr   label_E3DB
    ld   a, $10
    ld   [$D368], a
    jr   label_E3D2
    ld   a, $01
    ldh  [$FFF2], a

label_E3D2::
    call IsEntityFrameCounterZero
    ld   a, $68
    ld   [hl], a
    ld   [$C111], a

label_E3DB::
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $05
    jp   label_CAF
    ld   a, $10
    ld [wWorldMusicTrack], a
    call IncrementEntityWalkingAttr
    jr   label_E3DB

data_E3EE::
    db $E4, $14, $E4, $14

data_E3F2::
    db $D4, $D4, 4, 4, $3E, 2, $1E, 5, $18, 4, $3E, 1, $1E, 1, $EA, $7C
    db $D4, $7B, $EA, $A9, $C1, $3E, $30, $EA, $AA, $C1, $EA, $11, $C1, $AF, $EA, $7A
    db $D4, $3E, $27, $EA, $68, $D3, $3E, $49, $E0, $BD, $E0, $BF

label_E41E::
    ld   e, $03
    ld   d, $00

label_E422::
    push de
    ld   hl, data_E3EE
    add  hl, de
    ldh a, [hLinkPositionX]
    add [hl]
    ldh [$d7], a
    ld   hl, data_E3F2
    add  hl, de
    ldh a, [hLinkPositionY]
    add [hl]
    ldh [$d8], a
    ld   a, $07
    call label_CC7
    ld   hl, $C520
    add  hl, de
    ld   [hl], $22
    ld   hl, $C590
    add  hl, de
    pop  de
    ld   [hl], e
    dec  e
    ld   a, e
    cp   $FF
    jr   nz, label_E422
    ret


    ld a, [wDidFindSword]
    and  a
    jr   nz, label_E468

    ld a, $0f
    ld [wWorldMusicTrack], a
    ld [wC167], a
    call label_E3A1
    call IsEntityFrameCounterZero
    ld   [hl], $A0
    ld   a, $FF
    ldh  [$FFBF], a
    ret

label_E468::
    ld hl, wEntitiesUnknownTableB
    add  hl, bc
    ld   a, [hl]
    ld [wShieldLevel], a
    ld   d, $04

; Item ID stored in [d] is added to the first open inventory slot
AddItemToInventory::
    ld   hl, wAButtonSlot
    ld   e, INVENTORY_SLOT_COUNT

; Search through inventory for a matching item ID
label_E477::
    ld   a, [hli]
    cp   d
    jr   z, label_E48E
    dec  e
    jr   nz, label_E477
    ld hl, wAButtonSlot
	
; Look for an empty inventory slot and load the item into it
label_E481::
    ld   a, [hl]
    and  a
    jr   nz, label_E487
    ld   [hl], d
    ret

label_E487::
    inc  hl
    inc  e
    ld   a, e
    cp   $0C
    jr   nz, label_E481

label_E48E::
    ret


    ldh a, [hMapIndex]
    cp   $80
    jr   z, label_E4A5

    ldh a, [hMapIndex]
    cp $7c
    jr   nz, label_E4A0
    ld   hl, $D969
    set  4, [hl]

label_E4A0::
    ldh  a, [$FFF1]
    and  a
    jr   z, label_E4AD

label_E4A5::
    ld   a, $10
    ld [wWorldMusicTrack], a
    jp   label_E3D2

label_E4AD::
    call label_D12A
    ld   hl, $DBD0
    inc  [hl]
    jp   label_2802
    ld   a, $08

label_E4B9::
    ld   hl, wSubstractRupeeBufferLow

label_E4BC::
    add  a, [hl]
    ld   [hl], a
    ret
    ld   a, $01
    ld   hl, wAddRupeeBufferHigh
    jr   label_E4BC
    ld   a, $30
    jr   label_E4B9

label_E4CA::
    ld   e, $0F
    push af ; Push $36A0 after killing first boss ($36 points to something that points to something that loads a heart)
    ld   d, $00

label_E4CF::
    ld hl, wEntitiesTypeTable
    add  hl, de
    ld   a, [hl]
    and  a
    jr   z, label_E4E0 ; This jump is where $36A0 gets popped and used to load the heart ultimately
    dec  e
    ld   a, e
    cp   $FF
    jr   nz, label_E4CF
    pop  af
    scf
    ret

label_E4E0::
    ld   [hl], $05
    pop  af
    ld   hl, $C3A0
    add  hl, de
    ld   [hl], a
    ld hl, wEntity0PosX
    add  hl, bc
    ld   a, [hl]
    ldh [$d7], a
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    ldh  [$FFD8], a
    ld   hl, $C380
    add  hl, bc
    ld   a, [hl]
    ldh  [$FFD9], a
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    ldh  [$FFDA], a
    call label_E524
    ld   hl, $C410
    add  hl, de
    ld   [hl], $01
    ld   hl, $C220
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C220
    add  hl, de
    ld   [hl], a
    ld   hl, $C230
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C230
    add  hl, de
    ld   [hl], a
    scf
    ccf
    ret

label_E524::
    push bc
    push de
    ld   c, e
    ld   b, d
    call label_C85B
    pop  de
    pop  bc
    ret

data_E52E::
    db $80, $15

data_E530::
    db $F8, $F8, $32, 1, $F8, 0, $32, $21, $F8, 8, $32, 1, $F8, $10, $32, $21
    db 8, $F8, $32, 1, 8, 0, $32, $21, 8, 8, $32, 1, 8, $10, $32, $21
    db $F8, $F8, $10, 2, $F8, 0, $12, 2, $F8, 8, $12, $22, $F8, $10, $10, $22
    db 8, $F8, $10, $42, 8, 0, $12, $42, 8, 8, $12, $62, 8, $10, $10, $62
    db $FC, $FC, $30, $11, $FC, 4, $30, $31, $FC, 4, $30, $11, $FC, $C, $30, $31
    db 4, $FC, $30, $11, 4

data_E585::
    db 4, $30, $31, 4, 4, $30, $11, 4

data_E58D::
    db $C, $30, $31, $FC, $FC, $30, 1, $FC

data_E595::
    db 4, $30, $21, $FC, 4, $30, 1, $FC

data_E59D::
    db $C, $30, $21, 4, $FC, $30, 1, 4

data_E5A5::
    db 4, $30, $21, 4

data_E5A9::
    db 4, $30, 1, 4

data_E5AD::
    db $C, $30, $21

label_E5B0::
    ld   hl, $C3B0
    add  hl, bc
    ld   a, [hl]
    sla  a
    sla  a
    sla  a
    sla  a
    sla  a
    ld   e, a
    ld   d, b
    ld   hl, $6530
    add  hl, de
    ld   c, 8
    jp   label_3CE6

data_E5CA::
    db 0, 0, 0, 0, 0, 0, 0

data_E5D1::
    db 0, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3
    db 3

label_E5E2::
    call label_E650
    call label_FF78
    call IsEntityFrameCounterZero
    and  a
    jp   nz, label_E5F2
    jp   label_3F8D

label_E5F2::
    ld   e, a
    ld   hl, $C440
    add  hl, bc
    ld   a, [hl]
    cp   $4C
    ld   a, e
    jp   z, label_E64F
    cp   $0E
    jr   c, label_E614
    cp   $17
    jr   nc, label_E614
    push af
    sub  a, $0E
    ld   e, a
    ld   d, b
    push de
    call label_E8F8
    pop  de
    call label_E771
    pop  af

label_E614::
    cp   $12
    jr   nz, label_E64F
    ld   hl, $C440
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   nz, label_E625
    call label_F7D9
    jr   label_E64A

label_E625::
    ldh a, [$ee]
    ld hl, hLinkPositionX
    sub [hl]
    add $18
    cp   $30
    jr   nc, label_E64A

    ldh a, [$ef]
    ld hl, hLinkPositionY
    sub [hl]
    add $18
    cp   $30
    jr   nc, label_E64A
    call label_ECD5
    ld   hl, $FF9A
    sla  [hl]
    ld   hl, $FF9B
    sla  [hl]

label_E64A::
    ld   a, $04
    ld   [$C502], a

label_E64F::
    ret

label_E650::
    call IsEntityFrameCounterZero
    ld   e, a
    ld   d, b
    ld   hl, data_E5CA
    add  hl, de
    ld   a, [hl]
    call label_3B0C
    ld   hl, $C340
    add  hl, bc
    ld   a, [hl]
    and  $F0
    or   $08
    ld   [hl], a
    call label_E5B0
    ld a, [wActiveRoom]
    and  a
    jr   z, label_E68B

    ld a, [wTransitionSequenceCounter]
    cp   $04
    ret  nz

    ld e, $e4
    ld a, [wMapSlideTransitionState]
    and  a
    jr   nz, label_E687
    call IsEntityFrameCounterZero
    and  $04
    jr   z, label_E687
    ld   e, $84

label_E687::
    ld hl, wBGPalette
    ld   [hl], e

label_E68B::
    ret

label_E68C::
    ld   de, data_D484
    call label_3BC0
    call label_FF78
    ret
    ldh  a, [$FFEC]
    add  a, $10
    cp   $A0
    jp   nc, label_3F8D
    call IsEntityFrameCounterZero
    cp   $18
    jp  c, label_E5E2
    jr   nz, label_E6AD
    dec  [hl]
    call label_C4B

label_E6AD::
    ld hl, wHasPlacedBomb
    inc  [hl]
    cp   $22
    jr   c, label_E68C
    cp   $48
    jr   nz, label_E6BF
    ld   hl, $C420
    add  hl, bc
    ld   [hl], $30

label_E6BF::
    call label_E711
    call label_DCEA
    call label_FF78
    call label_E0B3
    ld   hl, $C300
    add  hl, bc
    ld   [hl], $FF
    call label_C00
    ld   hl, $C440
    add  hl, bc
    or   [hl]
    jr   nz, label_E6FA

    ld a, [wAButtonSlot]
    cp   $02
    jr   nz, label_E6EA
    ldh  a, [$FFCC]
    and  $20
    jr   nz, label_E6F7
    jr   label_E6FA

label_E6EA::
    ld a, [wBButtonSlot]
    cp   $02
    jr   nz, label_E6FA
    ldh  a, [$FFCC]
    and  $10
    jr   z, label_E6FA

label_E6F7::
    call label_CE35

label_E6FA::
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   a, [hl]
    and  $03
    jr   z, label_E706
    call label_EB34

label_E706::
    ldh  a, [$FFF9]
    and  a
    ret  nz
    ld   a, [hl]
    and  $0C
    ret  z
    jp   label_EB43

label_E711::
    ld   hl, $FFEC
    inc  [hl]
    inc  [hl]
    ld   de, data_E52E
    call label_3C77
    jp   label_3D8A

data_E71F::
    db $F8, 8, $18, $F8, 8, $18, $F8, 8, $18

data_E728::
    db $F8, $F8, $F8, 8, 8, 8, $18, $18, $18, $48, $48, 0, $90, 0, $70, $38
    db $38

data_E739::
    db $3D, $3D, $3E, $3E

data_E73D::
    db $72, $72, $73, $73, 4, 4, 4, 4, $69, $79, $69

data_E748::
    db $79, 4, 4, 4, 4

data_E74D::
    db $64, $66, $65, $67

data_E751::
    db $64, $66, $64, $66

data_E755::
    db 4, 8, 2, 1

data_E759::
    db 8, 4, 1, 2

data_E75D::
    db $F8, 8, $FF, 1

data_E761::
    db $72, $73, $73, $72, 0, 0, 0, 0

data_E769::
    db 0, $10, $F0, $10

data_E76D::
    db 0, 0, $10, 0

label_E771::
    ldh  a, [$FFF9]
    and  a
    jp   nz, label_E8E5
    push bc
    ld hl, wEntity0PosX
    add  hl, bc
    ld   a, [hl]
    sub  a, $08
    ld   hl, data_E71F
    add  hl, de
    add  a, [hl]
    and  $F0
    ldh  [$FFCE], a
    swap a
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   c, a
    ld   a, [hl]
    sub  a, $10
    ld   hl, data_E728
    add  hl, de
    add  a, [hl]
    and  $F0
    ldh  [$FFCD], a
    or   c
    ld   c, a
    ld   b, $00
    ld hl, wTileMap
    ld   a, h
    add  hl, bc
    ld   h, a
    ld   a, c
    ldh  [$FFE9], a
    ld   a, [hl]
    ldh  [$FFAF], a
    ld   e, a
    cp   $BB
    jr   c, label_E828
    cp   $BF
    jr   nc, label_E828

    ld a, [wActiveRoom]
    and  a
    jr   nz, label_E828
    ld   a, $02
    ldh  [$FFF2], a
    ldh  a, [$FFCD]
    and  $E0
    ldh  [$FFCD], a
    ldh  a, [$FFCE]
    and  $E0
    ldh  [$FFCE], a
    ld   a, $03
    call label_AA7
    ld   a, c
    and  $EE
    ld   c, a
    ld hl, wTileMap
    add  hl, bc
    ld   a, $09
    ldi  [hl], a
    ldd  [hl], a
    ld   a, $83
    call label_B2F
    inc  hl
    ld   a, $83
    call label_B2F
    dec  hl
    ld   a, l
    add  a, $10
    ld   l, a
    ld   a, $09
    ldi  [hl], a
    ld   [hl], a
    ld   [$DDD8], a
    ld   a, $83
    call label_B2F
    dec  hl
    ld   a, $83
    call label_B2F
    inc  hl
    ld   c, $03
    ld   b, $00

label_E802::
    call label_E822
    ld   hl, data_E769
    add  hl, bc
    ld   a, [hl]
    ld   hl, $FFCE
    add  a, [hl]
    ld   [hl], a
    ld   hl, data_E76D
    add  hl, bc
    ld   a, [hl]
    ld   hl, $FFCD
    add  a, [hl]
    ld   [hl], a
    dec  c
    ld   a, c
    cp   $FF
    jr   nz, label_E802
    jp   label_E8E4

label_E822::
    ld   de, data_E761
    jp   label_E865

label_E828::
    ld a, [wActiveRoom]
    ld   d, a
    call label_2A26
    sub  a, $99
    jp  c, label_E8E4
    cp   $04
    jp   nc, label_E8E4
    ld   c, a
    ld   a, $02
    ldh [$f2], a
    ld a, [wActiveRoom]
    and  a
    jr   nz, label_E878
    pop  bc
    ldh  a, [$FFE9]
    ld   e, a
    ld   d, b
    ld hl, wTileMap
    add  hl, de
    ld   a, $E1
    ld   [hl], a
    ld   [$DDD8], a
    ld   a, $83
    call label_B2F
    ldh a, [hIsGBC]
    and  a
    jr   z, label_E862
    ld   de, data_E751
    jr   label_E865

label_E862::
    ld   de, data_E74D

label_E865::
    push de
    ld hl, wMinimapTiles
    ldh a, [hMapIndex]
    ld   e, a
    ld   d, $00
    add  hl, de
    ld   a, [hl]
    or   $04
    ld   [hl], a
    ldh  [$FFF8], a
    jp   label_D1F5

label_E878::
    ld hl, $d900
    ldh a, [hMapIndex]
    ld   e, a
    ld   d, $00
    ldh a, [hMapTileset]
    cp $ff
    jr   nz, label_E88B
    ld   hl, $DDE0
    jr   label_E894

label_E88B::
    cp   $1A
    jr   nc, label_E894
    cp   $06
    jr   c, label_E894
    inc  d

label_E894::
    add  hl, de
    ld   e, l
    ld   d, h
    ld   hl, data_E755
    add  hl, bc
    ld   a, [de]
    or   [hl]
    ld   [de], a
    ldh  [$FFF8], a
    ld   hl, data_E75D
    add  hl, bc
    ld   a, [$DBAE]
    add  a, [hl]
    ld   e, a
    ld   d, $00
    call label_2BC1
    ld   e, l
    ld   d, h
    ld   hl, data_E759
    add  hl, bc
    ld   a, [de]
    or   [hl]
    ld   [de], a
    ldh  a, [$FFCE]
    swap a
    and  $0F
    ld   e, a

label_E8BE::
    ldh  a, [$FFCD]
    and  $F0
    or   e
    ld   e, a
    ld   d, $00
    ld hl, wTileMap
    add  hl, de
    ld   e, l
    ld   d, h
    ld   hl, data_E739
    add  hl, bc
    ld   a, [hl]
    ld   [de], a
    ld   [$DDD8], a
    ld   a, c
    and  $02
    rla
    rla
    ld   c, a
    ld   hl, data_E73D
    add  hl, bc
    pop  bc
    push hl
    jp   label_D1F5

label_E8E4::
    pop  bc

label_E8E5::
    ret

data_E8E6::
    db $F8, 8, $18, $F8, 8, $18, $F8, 8, $18

data_E8EF::
    db $F8, $F8, $F8, 8, 8, 8, $18, $18, $18

label_E8F8::
    push bc
    ld   hl, data_E8E6
    add  hl, de
    ldh  a, [$FFEE]
    add  a, [hl]
    sub  a, $08
    and  $F0
    ldh  [$FFCE], a
    swap a
    ld   c, a
    ld   hl, data_E8EF
    add  hl, de
    ldh  a, [$FFEC]

label_E90F::
    add  a, [hl]
    sub  a, $10
    and  $F0
    ldh  [$FFCD], a
    or   c
    ld   e, a
    ld hl, wTileMap
    add  hl, de
    ld   a, h
    cp   $D7
    jp   nz, label_E9A0

    ld a, [wActiveRoom]
    and  a
    ld   a, [hl]
    ldh  [$FFAF], a
    jr   nz, label_E93C
    ldh  [$FFE9], a
    cp   $0A
    jr   z, label_E964
    cp   $D3
    jr   z, label_E964
    cp   $5C
    jr   z, label_E964
    jp   label_E9A0

label_E93C::
    cp   $A9
    jp   nz, label_E9A0

    ld hl, $d900
    ldh a, [hMapIndex]
    ld   c, a
    ld   b, $00
    ldh a, [hMapTileset]
    cp $ff
    jr   nz, label_E954
    ld   hl, $DDE0
    jr   label_E95D

label_E954::
    cp   $1A
    jr   nc, label_E95D
    cp   $06
    jr   c, label_E95D
    inc  b

label_E95D::
    add  hl, bc
    ld   a, [hl]
    or   $40
    ld   [hl], a
    ldh  [$FFF8], a

label_E964::
    call label_2178
    ld   a, $05
    call label_E4CA
    jr   c, label_E9A0
    xor  a
    ld [$c19b], a
    ld hl, wEntity0PosX
    add  hl, de
    ldh  a, [$FFCE]
    add  a, $08
    ld   [hl], a
    ld hl, wEntitiesPosYTable
    add  hl, de
    ldh  a, [$FFCD]
    add  a, $10
    ld   [hl], a
    ld   hl, $C3B0
    add  hl, de
    ld a, [wActiveRoom]
    xor  $01
    ld   [hl], a
    ldh  [$FFF1], a
    ldh  a, [$FFE9]
    cp   $0A
    jr   nz, label_E99B
    ld   a, $FF
    ld   [hl], a
    ldh  [$FFF1], a

label_E99B::
    ld   c, e
    ld   b, d
    call label_D3E4

label_E9A0::
    pop  bc
    ret

data_E9A2::
    db $6C, $74, $6D, $75 ; ltmu -> mult as in multiply?
    db 0, 0, 0, 0

data_E9AA::
    ; 6.6"6.62!M-4>.OP
    ; --óu=t...µ.!¦+.w
    ; -..(.=-.?.DL++
    db $36, 2, $36, $22, $36, $12, $36, $32, $21, $4D, $C1, $34, $3E, $A, $EA, $9E
    db $C1, $CD, $A2, $75, $F0, $E7, $1F, $1F, $1F, $E6, 1, $21, $B0, $C3, 9, $77
    db $CD, 0, $C, $28, $A, $3D, $CA, $8D, $3F, $11, $44, $4C, $C3, $C0, $3B

label_E9D9::
    ld   de, data_E9AA
    call label_EAD7
    call label_FF78
    ld a, [wActiveRoom]
    and  a
    ldh  a, [$FFAF]
    jr   z, label_E9F0
    cp   $8A
    jr   z, label_E9F8
    jr   label_EA1D

label_E9F0::
    cp   $D3
    jr   z, label_E9F8
    cp   $5C
    jr   nz, label_EA1D

label_E9F8::
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   [hl], b
    call label_C00
    ld   [hl], b
    ldh  a, [$FFE9]
    ld   e, a
    ld   d, b
    call label_2178
    ldh  a, [$FFCE]
    add  a, $08
    ldh  [$FFD7], a
    ldh  a, [$FFCD]
    add  a, $10
    ldh  [$FFD8], a
    ld   a, $08
    call label_CC7
    ld   a, $13
    ldh  [$FFF4], a

label_EA1D::
    ret

data_EA1E::
    db $6C, 1, $6C, $21, $5C, 1, $5C, $21, $CD, 5, $C, $20, 3, $CD, $DE, $6B

label_EA2E::
    ld   de, data_EA1E
    jp   label_EAD7


    ld hl, wProjectileCount
    inc  [hl]
    ldh  a, [$FFF0]
    and  a
    jr   nz, label_EA70
    call IsEntityFrameCounterZero
    jp   nz, label_EAD4
    ld   a, $05
    ld   [$C19E], a
    call label_F5A2
    call label_EAD4
    ldh  a, [$FFF1]
    cp   $02
    ret  nz
    ld   a, [$C18E]
    and  $1F
    cp   $0F
    ret  nz
    ldh  a, [$FFAF]
    cp   $C0
    ret  nz
    call label_C60
    jp   label_3F8D

data_EA66::
    db $80, $15

data_EA68::
    db 4, $FC, 0, 0

data_EA6C::
    db $FE, $FE, $FA
    inc  b

label_EA70::
    call IsEntityFrameCounterZero
    jr   z, label_EA96
    ld   a, $02
    call label_E4CA
    jr   c, label_EA93

    ldh a, [$d7]
    ld hl, wEntity0PosX
    add  hl, de
    ld   [hl], a
    ldh a, [$d8]
    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   [hl], a
    ld hl, wEntitiesFrameCounterTable
    add  hl, de
    ld   [hl], $17
    call label_C4B

label_EA93::
    jp   label_3F8D

label_EA96::
    ldh  a, [$FFF1]
    push af
    ld   e, a
    ld   d, b
    xor  a
    ldh  [$FFF1], a
    ld   hl, data_EA68
    add  hl, de
    ldh  a, [$FFEE]
    add  a, [hl]
    ldh  [$FFEE], a
    ld   hl, data_EA6C
    add  hl, de
    ldh  a, [$FFEC]
    add  a, [hl]
    ldh  [$FFEC], a
    ld   de, data_EA66
    call label_3C77
    call label_3D8A
    pop  af
    ldh  [$FFF1], a
    ld   de, data_EBC6
    call label_3BC0
    ld   a, $0C
    ld   [$C19E], a
    call label_F5A2
    jr   label_EADA
    call IsEntityFrameCounterZero
    jr   nz, label_EAD4
    call label_EBDE

label_EAD4::
    ld   de, data_EBC6

label_EAD7::
    call label_3BC0

label_EADA::
    call label_FF78
    call IsEntityFrameCounterZero
    jr   nz, label_EB4C
    call label_FF25
    call label_FCAB
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_EB42
    call IsEntityFrameCounterZero
    ldh  a, [$FFEB]
    cp   $04
    jr   nz, label_EAFF
    call label_C00
    ld   [hl], $30
    ret

label_EAFF::
    ld   [hl], $18
    ld   hl, $C320
    add  hl, bc
    ld   [hl], $10
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   a, [hl]
    inc  a
    jr   z, label_EB13
    ld   a, $07
    ldh  [$FFF2], a

label_EB13::
    call label_C50
    ldh  a, [$FFEB]
    cp   $00
    jr   nz, label_EB31
    call label_EB2C
    ld   hl, $C240

label_EB22::
    add  hl, bc
    ld   a, [hl]
    cpl
    inc  a
    sra  a
    sra  a
    ld   [hl], a
    ret

label_EB2C::
    ld   hl, $C250
    jr   label_EB22

label_EB31::
    call label_EB43

label_EB34::
    ld   hl, $C240

label_EB37::
    add  hl, bc
    ld   a, [hl]
    cpl
    inc  a
    sra  a
    sra  a
    sra  a
    ld   [hl], a

label_EB42::
    ret

label_EB43::
    ld   hl, $C250
    jr   label_EB37

data_EB48::
    db 0, 3, 1, 2

label_EB4C::
    cp   1
    jr   nz, label_EB53
    jp   label_3F8D

label_EB53::
    ldh  a, [$FFEB]
    cp   $0A
    jr   z, label_EB6E
    call IsEntityFrameCounterZero
    srl  a
    srl  a
    srl  a
    and  $03
    ld   e, a
    ld   d, b
    ld   hl, data_EB48
    add  hl, de
    ld   a, [hl]
    call label_3B0C

label_EB6E::
    call label_FF25
    jr   label_EB7B

data_EB73::
    db 2, 1, 2, 2

data_EB77::
    db $40, 8, $40, $40

label_EB7B::
    ldh  a, [$FFF9]
    and  a
    jr   nz, label_EB8C
    call label_FF5E
    ld   hl, $C320
    add  hl, bc
    ld   a, [hl]
    sub  a, $02
    ld   [hl], a
    ret

label_EB8C::
    ld   hl, $C470
    add  hl, bc
    ld   a, [hl]
    ld   e, a
    ld   d, b
    and  a
    jr   z, label_EBAB

    ldh a, [hFrameCounter]
    and  $07
    jr   nz, label_EBAB
    ld   hl, $C240
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_EBAB
    and  $80
    jr   z, label_EBAA
    inc  [hl]
    inc  [hl]

label_EBAA::
    dec  [hl]

label_EBAB::
    ld   hl, data_EB73
    add  hl, de
    ld   a, [hl]
    ld   hl, $C250
    add  hl, bc
    add  a, [hl]
    ld   [hl], a
    ld   hl, data_EB77
    add  hl, de
    sub  a, [hl]
    and  $80
    jr   nz, label_EBC5
    ld   a, [hl]
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a

label_EBC5::
    ret

data_EBC6::
    db $2E, $21, $2C, $21, $2C, 1, $2E, 1, $2A, $41, $2A, $61, $2A, 1, $2A, $21

data_EBD6::
    db 1, 0, 3, 2

data_EBDA::
    db 2, $A, $E, 6

label_EBDE::
    ld   a, [wLinkMotionState]
    cp   $02
    jr   nc, label_EC5A
    ldh  a, [$FFA2]
    and  a
    jr   nz, label_EC5A

    ld hl, $ffee
    ldh a, [hLinkPositionX]
    sub [hl]
    add $06
    cp $0c
    jr   nc, label_EC5A

    ld hl, $ffec
    ldh a, [hLinkPositionY]
    sub [hl]
    add $06
    cp $0c
    jr   nc, label_EC5A

    ld a, [wIsUsingShield]
    and  a
    jr   z, label_EC5B
    ldh  a, [$FFEB]
    cp   $2B
    jr   nz, label_EC41

    ld a, [wShieldLevel]
    cp   $02
    jr   c, label_EC5B
    ldh  a, [$FF9E]
    ld   e, a
    ld   d, b
    ld   hl, data_EBDA
    add  hl, de
    ld   e, [hl]
    ld   hl, $C380
    add  hl, bc
    ld   a, [hl]
    sub  a, e
    and  $0F
    cp   $05
    jr   nc, label_EC5B

    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   [hl], $02
    ld   a, $07
    ldh  [$FFF2], a
    ldh  a, [$FFEF]

label_EC36::
    ldh  [$FFD8], a
    ldh  a, [$FFEE]
    ldh  [$FFD7], a
    ld   a, $05
    jp   label_CC7

label_EC41::
    ld   hl, $C380
    add  hl, bc
    ld   e, [hl]
    ld   d, b
    ld   hl, data_EBD6
    add  hl, de
    ldh  a, [$FF9E]
    cp   [hl]
    jr   nz, label_EC5B
    ld   a, $16
    ldh  [$FFF2], a

label_EC54::
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   [hl], $FF

label_EC5A::
    ret

label_EC5B::
    call label_ECC0
    ldh  a, [$FFEB]
    cp   $2B
    jr   z, label_EC68
    cp   $0C
    jr   nz, label_EC54

label_EC68::
    jp   label_3F8D

label_EC6B::
    ldh a, [hFrameCounter]
    xor  c
    rra
    jp   nc, label_ECCB

label_EC72::
    ldh  a, [$FFA2]
    and  a
    jr   nz, label_EC5A

label_EC77::
    ld   a, [wLinkMotionState]
    cp   $02
    jr   nc, label_EC5A
    push bc
    sla  c
    sla  c
    ld   hl, $D580
    add  hl, bc
    pop  bc
    ldh  a, [$FFEE]
    add  a, [hl]
    push hl
    ld hl, hLinkPositionX
    sub [hl]
    sub $08
    cp   $80
    jr   c, label_EC98
    cpl
    inc  a

label_EC98::
    pop  hl
    push af
    inc  hl
    ld   a, $04
    add  a, [hl]
    ld   e, a
    pop  af
    cp   e
    jp   nc, label_ECCB
    inc  hl
    ldh  a, [$FFEC]
    add  a, [hl]
    push hl
    ld hl, hLinkPositionY
    sub [hl]
    sub $08
    cp   $80
    jr   c, label_ECB5
    cpl
    inc  a

label_ECB5::
    pop  hl
    push af
    inc  hl
    ld   a, $04
    add  a, [hl]
    ld   e, a
    pop  af
    cp   e
    jr   nc, label_ECCB

label_ECC0::
    ld   hl, $C340
    add  hl, bc
    ld   a, [hl]
    and  $80
    jr   z, label_ECCD

label_ECC9::
    scf
    ret

label_ECCB::
    and  a
    ret

label_ECCD::
    ldh a, [hLinkAnimationState]
    sub $4e
    cp   $02
    jr   c, label_ECC9

label_ECD5::
    ldh  a, [$FFEB]
    cp   $AC
    jr   nz, label_ECF9
    call label_FEE9
    ld   a, e
    cp   $02
    jr   nz, label_ED3D
    call IncrementEntityWalkingAttr
    ld   [hl], $05
    ld   a, $02
    ld   [$C146], a
    ld   a, $F0
    ldh  [$FF9B], a
    call label_3D7F
    ld a, $0e
    ldh [hSFX], a
    ret

label_ECF9::
    ldh  a, [$FFEB]
    cp   $9F
    jr   nz, label_ED3D
    ld   a, [$C146]
    and  a
    jr   z, label_ED3D
    ldh  a, [$FFB7]
    and  a
    jr   nz, label_ED1B
    ldh  a, [$FFF9]
    and  a
    jr   nz, label_ED15
    ldh  a, [$FFA3]
    xor  $80
    jr   label_ED17

label_ED15::
    ldh  a, [$FF9B]

label_ED17::
    and  $80
    jr   nz, label_ED3D

label_ED1B::
    ld   a, $02
    ldh [$b7], a
    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   [hl], $02
    call IsEntityFrameCounterZero
    ld   [hl], $30
    ld a, $0e
    ldh [hSFX], a
    ldh a, [$f9]
    and  a
    jr   nz, label_ED38
    ld   a, $10
    ldh  [$FFA3], a
    ret

label_ED38::
    ld   a, $F0
    ldh  [$FF9B], a
    ret

label_ED3D::
    ldh  a, [$FFEB]
    cp   $1C
    jr   nz, label_ED4E
    call IsEntityFrameCounterZero
    ld   [hl], $80
    call IncrementEntityWalkingAttr
    ld   [hl], $04
    ret

label_ED4E::
    cp   $8E
    jr   z, label_ED5D
    cp   $82
    jr   z, label_ED5D
    ld   a, [$C13E]
    and  a
    jp   nz, label_EE0A

label_ED5D::
    ldh  a, [$FFEB]
    cp   $E4
    jr   nz, label_ED73
    ldh  a, [$FFF0]
    cp   $04
    jr   nz, label_ED73
    call IncrementEntityWalkingAttr
    ld   [hl], $08
    ld   a, $03
    ldh [hSFX], a
    ret

label_ED73::
    ld   a, [$DBC7]
    ld   hl, $C1C6
    or   [hl]
    ld   hl, $C166
    or   [hl]
    ld   hl, $C1A9
    or   [hl]
    jp   nz, label_EE0A
    ld   a, $03
    ldh [hSFX], a
    ld hl, $c4d0
    add  hl, bc
    ld   d, b
    ld   e, [hl]
    ld   hl, data_C7F1
    add  hl, de
    ld   e, [hl]
    ld a, [wTunicType]
    cp   $02
    jr   z, label_EDA9
    ld   a, [wActivePowerUp]
    cp   $02
    jr   nz, label_EDAB
    ld   a, e
    cp   $04
    jr   nz, label_EDA9
    ld   e, $00

label_EDA9::
    srl  e

label_EDAB::
    ld   a, [$DB94]
    add  a, e
    ld   [$DB94], a
    ld   a, $50
    ld   [$DBC7], a
    xor  a
    ld   [$D471], a
    ld   a, [wActivePowerUp]
    and  a
    jr   z, label_EDDF
    ld   hl, $D47A
    inc  [hl]
    ld   a, [hl]
    cp   $03
    jr   c, label_EDDF
    xor  a
    ld   [wActivePowerUp], a
    ld   a, [$C1BE]
    and  a
    jr   nz, label_EDDF
    ldh  a, [$FFB0]
    cp   $22
    jr   z, label_EDDD

    ld [wWorldMusicTrack], a

label_EDDD::
    ldh  [$FFBF], a

label_EDDF::
    call label_CB6
    ld   a, $10
    ld   [$C13E], a
    ldh  a, [$FFEB]
    ld   e, $18
    cp   $82
    jp   z, label_EFA7
    cp   $5A
    jr   nz, label_EDFA

    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   [hl], $01

label_EDFA::
    cp   $59
    ld   a, $14
    jr   nz, label_EE02
    ld   a, $18

label_EE02::
    call label_F565
    ldh  a, [$FFF9]
    and  a
    jr   nz, label_EE0E

label_EE0A::
    scf
    ret

data_EE0C::
    db $C, $F4

label_EE0E::
    ldh  a, [$FF9C]
    cp   $02
    jr   z, label_EE0A
    call label_FED9
    ld   d, b
    ld   hl, data_EE0C
    add  hl, de
    ld   a, [hl]
    ldh  [$FF9A], a
    ld   a, $F4
    ldh  [$FF9B], a
    xor  a
    ldh  [$FF9C], a
    scf
    ret

label_EE28::
    call label_EC6B

label_EE2B::
    ld   a, [$C140]
    cp   $00
    jp   z, label_F3E6
    ld   hl, $C420
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_EE40
    cp   $18
    jp  c, label_F3E6

label_EE40::
    ld   a, [$C1AC]
    and  a
    jr   z, label_EE4B
    dec  a
    cp   c
    jp   z, label_F3E6

label_EE4B::
    ld   hl, $C410
    add  hl, bc
    ld   a, [hl]
    and  a
    jp   nz, label_F3E6
    ld   de, $FFEE
    push bc
    sla  c
    sla  c
    ld   hl, $D580
    add  hl, bc
    pop  bc
    ld   a, [de]
    add  a, [hl]
    push hl
    ld   hl, $C140
    sub  a, [hl]
    cp   $80
    jr   c, label_EE6E
    cpl
    inc  a

label_EE6E::
    pop  hl
    push af
    inc  hl
    ld   a, [$C141]
    add  a, [hl]
    ld   e, a
    pop  af
    cp   e
    jp   nc, label_F3E6
    inc  hl
    push hl
    ld   de, $FFEC
    pop  hl
    ld   a, [de]
    add  a, [hl]
    push hl
    ld   hl, $C142
    sub  a, [hl]
    cp   $80
    jr   c, label_EE8E
    cpl
    inc  a

label_EE8E::
    pop  hl
    push af
    inc  hl
    ld   a, [$C143]
    add  a, [hl]
    ld   e, a
    pop  af
    cp   e
    jp   nc, label_F3E6
    ld   hl, $C340
    add  hl, bc
    ld   a, [hl]
    and  $20
    jp   nz, label_E311
    ld   a, [$C5B0]
    and  a
    jp   nz, label_EFE8
    ld   a, [$C14A]
    ldh  [$FFE9], a
    call label_CB6
    ldh  a, [$FFEB]
    cp   $E2
    jr   nz, label_EED1

    ld a, [wShieldLevel]
    cp   $02
    ret  nz
    ldh  a, [$FF9E]
    cp   $02
    ret  nz
    ld   a, $04
    ldh  [$FF9B], a
    ld   a, $08
    ld   [$C13E], a
    jp   IncrementEntityWalkingAttr

label_EED1::
    cp   $55
    jr   nz, label_EEF7
    ldh  a, [$FFF0]
    cp   $02
    jp   nz, label_EF93
    ld   hl, $C240
    add  hl, bc
    ld   a, [hl]
    cpl
    inc  a
    ld   [hl], a
    ld   hl, $C250
    add  hl, bc
    ld   a, [hl]
    cpl
    inc  a
    ld   [hl], a
    call IsEntityFrameCounterZero
    ld   [hl], $40
    call label_C00
    ld   [hl], $08
    ret

label_EEF7::
    cp   $51
    jr   nz, label_EF20
    ld   hl, $C430
    add  hl, bc
    and  $40
    jp   z, label_EF93

label_EF04::
    ld hl, wEntitiesUnknownTableB
    add  hl, bc
    ld   a, [hl]
    cpl
    inc  a
    ld   [hl], a
    call label_EF5C
    call label_C00
    ld   [hl], $0C
    ld   a, $01
    ld   [$C160], a
    xor  a
    ld   [$C122], a
    jp   label_F13B

label_EF20::
    cp   $58
    jr   nz, label_EF2A

label_EF24::
    call label_EF93
    jp   label_EC54

label_EF2A::
    cp   $2C
    jr   nz, label_EF6D

    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   a, [hl]
    cp   $03
    jr   z, label_EF5C
    ld   [hl], $03
    ld   hl, $C320
    add  hl, bc
    ld   [hl], $20
    call IsEntityFrameCounterZero
    ld   [hl], $FF
    ldh  a, [$FF9E]
    ld   e, a
    ld   d, b
    ld   hl, data_EF65
    add  hl, de
    ld   a, [hl]
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    ld   hl, data_EF69
    add  hl, de
    ld   a, [hl]
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a

label_EF5C::
    call label_EF93
    ld   hl, $C410
    add  hl, bc
    ld   [hl], b
    ret

data_EF65::
    db $10, $F0

data_EF67::
    db 0, 0

data_EF69::
    db 0, 0

label_EF6B::
    ld   a, [$FF10]

label_EF6D::
    cp   $9C
    jr   z, label_EF75
    cp   $15
    jr   nz, label_EF8E

label_EF75::
    ldh  a, [$FF9E]
    and  $02
    jr   nz, label_EF81
    ld   hl, $C240
    add  hl, bc
    jr   label_EF85

label_EF81::
    ld   hl, $C250
    add  hl, bc

label_EF85::
    ld   a, [hl]
    cpl
    inc  a
    ld   [hl], a
    call label_EF93
    ld   [hl], b
    ret

label_EF8E::
    cp   $5A
    jp   z, label_EF24

label_EF93::
    ld   a, $09
    ldh  [$FFF2], a
    call label_CB6
    ld   a, $0C
    ld   [$C13E], a
    ldh  a, [$FFEB]
    cp   $82
    jr   nz, label_EFB9
    ld   e, $10

label_EFA7::
    push de
    call label_FED9
    ld   a, e
    and  a
    pop  de
    ld   a, e
    jr   z, label_EFB3
    cpl
    inc  a

label_EFB3::
    ldh  [$FF9A], a
    xor  a
    ldh  [$FF9B], a
    ret

label_EFB9::
    ld   a, $12
    call label_F565
    ld hl, hFFE9
    ldh a, [hPressedButtonsMask]
    and $0f
    ld   a, $08
    or   [hl]
    jr   z, label_EFCC
    ld   a, $20

label_EFCC::
    call label_FE45
    ldh  a, [$FFD7]
    cpl
    inc  a
    ld   hl, $C400
    add  hl, bc
    ld   [hl], a
    ldh  a, [$FFD8]
    cpl
    inc  a
    ld   hl, $C3F0
    add  hl, bc
    ld   [hl], a
    jp   label_F3DB

data_EFE4::
    db 0, 1, 2, 3

label_EFE8::
    ldh  a, [$FFEB]
    cp   $E2
    ret  z
    cp   $E6
    jr   nz, label_F018
    ld   a, [$D219]
    rst  0
    ld   d, [hl]
    ld   c, e
    ld   bc, $770
    ld   [hl], b
    ld   d, $70
    ld   d, $70
    ld   b, d
    ld   [hl], b
    call IncrementEntityWalkingAttr
    ld   [hl], $06
    ret

label_F007::
    ld a, [wIsUsingSpinAttack]
    and  a
    jr   nz, label_F013
    ld   a, [$C16A]
    cp   $04
    ret  nc

label_F013::
    jp   IncrementEntityWalkingAttr
    ldh  a, [$FFEB]

label_F018::
    cp   $B9
    jr   nz, label_F042
    ldh  a, [$FFEA]
    cp   $05
    jr   nz, label_F042
    call IncrementEntityWalkingAttr
    ld   [hl], $01
    call IsEntityFrameCounterZero
    ld   [hl], $40
    ld   a, $40
    ld   [$D464], a
    xor  a
    ld [$c137], a
    ld [wC16A], a
    ld [wIsUsingSpinAttack], a
    ld a, $1c
    ldh [hFFF4], a
    jp   label_ECD5

label_F042::
    ldh  a, [$FFEB]
    cp   $55
    jr   nz, label_F06F
    ld   a, $30
    call label_FE45
    ldh  a, [$FFD7]
    cpl
    inc  a
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a
    ldh  a, [$FFD8]
    cpl
    inc  a
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    call IncrementEntityWalkingAttr
    ld   [hl], $02
    call IsEntityFrameCounterZero
    ld   [hl], $40
    call label_C00
    ld   [hl], $08
    ret

label_F06F::
    cp   $65
    jr   nz, label_F07D
    call label_EDDF
    ld   a, $08
    ld   [$C13E], a
    jr   label_F0B9

label_F07D::
    cp   $5B
    jr   nz, label_F0B9
    ldh  a, [$FFE8]
    and  a
    jr   nz, label_F0A9

    ld hl, wEntitiesUnknownTableB
    add  hl, bc
    ld   a, [hl]
    cp   $04
    jp   nz, label_F09D
    ld   a, [$C14A]
    and  a
    jr   z, label_F102
    ld   hl, $C300
    add  hl, bc
    ld   [hl], $0C
    ret

label_F09D::
    ld   a, [$C14A]
    and  a
    jr   z, label_F0AC
    call label_EDDF
    jp   label_F102

label_F0A9::
    jp   label_EDDF

label_F0AC::
    ld   a, $04
    ld   [$C13E], a
    ld   a, $10
    call label_F565
    jp   label_F102

label_F0B9::
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    and  $40
    jr   z, label_F102
    ldh  a, [$FFEB]
    cp   $51
    jp   z, label_EF04
    cp   $5C
    jr   nz, label_F0E7

    ld a, [wTunicType]
    cp   $01
    jr   z, label_F0DD
    ld   a, [wActivePowerUp]
    cp   $01
    ld   a, $20
    jr   nz, label_F0DF

label_F0DD::
    ld   a, $30

label_F0DF::
    call label_EFCC
    ld   hl, $C420
    add  hl, bc
    ld   [hl], b

label_F0E7::
    ld   a, c
    inc  a
    ld   [$C1AC], a
    call label_D07
    ld   hl, $C410
    add  hl, bc
    ld   [hl], $10
    ld   hl, $C3F0
    add  hl, bc
    ld   [hl], b
    ld   hl, $C400
    add  hl, bc
    ld   [hl], b
    jp   label_EDDF

label_F102::
    ldh  a, [$FFEB]
    cp   $8E
    jr   nz, label_F10D
    call label_CB6
    jr   label_F14D

label_F10D::
    cp   $24
    jr   nz, label_F146

    ld hl, wEntitiesUnknownTableC
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   nz, label_F146
    ldh  a, [$FF9E]
    ld   e, a
    ld   d, b
    ld   hl, data_EFE4
    add  hl, de
    ld   a, [hl]
    ld   hl, $C380
    add  hl, bc
    cp   [hl]
    jr   z, label_F14D
    call label_CB6
    ld   a, $10
    ld   [$C13E], a
    ld   a, $10
    call label_F565
    ld   a, $10
    call label_EFCC

label_F13B::
    ldh  a, [$FFEE]
    ldh  [$FFD7], a
    ldh  a, [$FFEC]
    ldh  [$FFD8], a
    jp   label_D15

label_F146::
    ldh  a, [$FFEB]
    cp   $15
    jp   z, label_F3E6

label_F14D::
    ld   a, $01
    ld   [$C160], a
    ld   a, [$C16A]
    cp   $05
    jr   nz, label_F15E
    ld   a, $0C
    ld   [$C16D], a

label_F15E::
    xor  a
    ld   [$C122], a
    ld   a, $30
    call label_EFCC
    ld   hl, $FFF2
    ld   [hl], $09
    ld a, [wTunicType]
    cp   $01
    jr   z, label_F17A
    ld   a, [wActivePowerUp]
    cp   $01
    jr   nz, label_F19D

label_F17A::
    call label_F19D
    ld   hl, $C410
    add  hl, bc
    ld   [hl], $20
    ld   hl, $C4A0
    add  hl, bc
    ld   [hl], $01
    ld   a, $11
    ldh [hSFX], a
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   a, [hl]
    cp   $01
    jr   nz, label_F19C
    ld   hl, $C480
    add  hl, bc
    ld   [hl], $40

label_F19C::
    ret

label_F19D::
    ld   a, c
    inc  a
    ld [$c1ac], a
    ld a, [wTunicType]
    and  $01
    jr   nz, label_F1AE
    ld   a, [wActivePowerUp]
    and  $01

label_F1AE::
    ld hl, wIsUsingSpinAttack
    or   [hl]
    ld   hl, $C14A
    or   [hl]
    ld a, [wDidFindSword]
    jr   z, label_F1BC
    inc  a

label_F1BC::
    dec  a
    ld   [$C19E], a

label_F1C0::
    ld   hl, $C4D0
    add  hl, bc
    ld   e, [hl]
    ld   d, b
    sla  e
    rl   d
    sla  e
    rl   d
    sla  e
    rl   d
    sla  e
    rl   d
    ld   hl, data_C3EC
    add  hl, de
    ld   a, [$C19E]
    ld   e, a
    ld   d, b
    add  hl, de
    ld   e, [hl]
    push de
    ld   a, [$C19E]
    rla
    rla
    rla
    and  $F8
    ld   e, a
    ld   hl, data_C73C
    add  hl, de
    pop  de
    add  hl, de
    ld   a, [hl]
    and  a
    ret  z
    push af
    ldh  a, [$FFEB]
    cp   $E6
    jr   nz, label_F215
    ld   a, [$D219]
    cp   $04
    jr   nz, label_F215
    ld   a, [$C14A]
    push af
    call label_EDDF
    pop  af
    and  a
    jr   nz, label_F215

    ld a, [wIsUsingSpinAttack]
    and  a
    jr   nz, label_F215
    pop  af
    ret

label_F215::
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    ld   hl, $FFF2
    ld   [hl], $03
    and  $80
    jr   z, label_F228

    ld hl, hSFX
    ld   [hl], $07

label_F228::
    ld   hl, $C3A0
    add  hl, bc
    ld   a, [hl]
    cp   $6C
    jr   nz, label_F235
    ld   a, $13
    ldh [hSFX], a

label_F235::
    pop  af
    cp   $F0
    jr   c, label_F2B5
    cp   $FE
    jr   nz, label_F260
    ld   hl, $FFF4
    ld   [hl], $12
    call label_F3DB
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $03
    call IsEntityFrameCounterZero
    ld   [hl], $60
    ld   hl, $C340
    add  hl, bc
    inc  [hl]
    inc  [hl]
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    and  $C2
    ld   [hl], a
    ret

label_F260::
    cp   $FF
    jr   nz, label_F279
    call label_F3DB

label_F267::
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $06
    ld   hl, $C300
    add  hl, bc
    ld   [hl], $FF
    ld   hl, $C320
    add  hl, bc
    ld   [hl], b
    ret

label_F279::
    cp   $FD
    ret  nz
    ld   hl, $C3A0
    add  hl, bc
    ld   a, [hl]
    cp   $F8
    jr   z, label_F289
    cp   $B9
    jr   nz, label_F293

label_F289::
    ld hl, wEntitiesUnknownTableB
    add  hl, bc
    ld   a, [hl]
    and  a
    ret  nz
    inc  [hl]
    jr   label_F29D

label_F293::
    ld   [hl], $2F
    call label_C85B
    call label_BFB
    ld   [hl], $80

label_F29D::
    ld hl, wEntity0PosX
    add  hl, bc
    ld   a, [hl]
    ldh [$d7], a
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C310
    add  hl, bc
    sub  a, [hl]
    ldh  [$FFD8], a
    ld   a, $02
    jp   label_CC7

label_F2B5::
    ld   e, a
    ld   hl, $C360
    add  hl, bc
    ld   a, [hl]
    sub  a, e
    ld   [hl], a
    jr   c, label_F2C2
    jp   nz, label_F3B6

label_F2C2::
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $01
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    bit  7, a
    jr   z, label_F33E
    bit  2, a
    jr   nz, label_F304
    ld   e, $0F
    ld   d, b

label_F2D8::
    ld   a, e
    cp   c
    jr   z, label_F2EE

    ld hl, wEntitiesTypeTable
    add  hl, de
    ld   a, [hl]
    cp   $05
    jr   nz, label_F2EE
    ld   hl, $C430
    add  hl, de
    ld   a, [hl]
    and  $80
    jr   nz, label_F304

label_F2EE::
    dec  e
    ld   a, e
    cp   $FF
    jr   nz, label_F2D8

    ld a, [wCurrentBank]
    push af
    ld   a, $03
    call SwitchBank
    call label_27F2
    pop  af
    ld [wCurrentBank], a

label_F304::
    ld   a, $03
    ld [$c5a7], a
    ld hl, wEntitiesUnknownTableC
    add  hl, bc
    ld   [hl], b
    ld   hl, $C3A0
    add  hl, bc
    ld   a, [hl]
    ld   e, $B7
    cp   $5A
    jr   z, label_F325
    ld   e, $B9
    cp   $63
    jr   z, label_F330
    ld   e, $BD
    cp   $62
    jr   nz, label_F33E

label_F325::
    ld   a, e
    call label_2385
    ld a, $5e
    ld [wWorldMusicTrack], a
    jr   label_F33E

label_F330::
    ldh a, [hLinkPositionY]
    push af
    ld   a, $10
    ldh [hLinkPositionY], a
    ld   a, e
    call label_2385
    pop  af
    ldh [hLinkPositionY], a

label_F33E::
    call IncrementEntityWalkingAttr
    ld   [hl], b
    ld   hl, $C480
    add  hl, bc
    ld   [hl], $2F
    ld   hl, $C420
    add  hl, bc
    xor  a
    ld   [hl], a
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    and  $80
    jr   nz, label_F361
    ld   hl, $C340
    add  hl, bc
    ld   a, [hl]
    and  $F0
    or   $04
    ld   [hl], a

label_F361::
    ld   hl, $C3A0
    add  hl, bc
    ld   a, [hl]
    cp   $12
    jr   nz, label_F3B6
    ld   e, $0F
    ld   d, b

label_F36D::
    ld   a, e
    cp   c
    jr   z, label_F3AA
    ld   hl, $C3A0
    add  hl, de
    ld   a, [hl]
    cp   $10
    jr   z, label_F37E
    cp   $11
    jr   nz, label_F3AA

label_F37E::
    ld hl, wEntitiesWalkingTable
    add  hl, de
    ld   a, [hl]
    and  a
    jr   nz, label_F3AA

    ld hl, wEntitiesTypeTable
    add  hl, de
    ld   a, [hl]
    and  a
    jr   z, label_F3AA
    ld   [hl], $01
    ld   hl, $C480
    add  hl, de
    ld   [hl], $1F
    call GetRandomByte
    and  $03
    push bc
    ld   c, a
    ld   b, $00
    ld   hl, label_F3E7
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C4E0
    add  hl, de
    ld   [hl], a
    pop  bc

label_F3AA::
    dec  e
    ld   a, e
    cp   $FF
    jr   nz, label_F36D
    ld   hl, $C4E0
    add  hl, bc
    ld   [hl], $2E

label_F3B6::
    ld   hl, $C3A0
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C420
    add  hl, bc
    cp   $E6
    jr   nz, label_F3CC
    ld   a, [$D219]
    cp   $03
    jr   z, label_F3D0
    jr   label_F3D9

label_F3CC::
    cp   $59
    jr   nz, label_F3D9

label_F3D0::
    ld   [hl], $28
    ld   hl, $C300
    add  hl, bc
    ld   [hl], $C8
    ret

label_F3D9::
    ld   [hl], $18

label_F3DB::
    ld   hl, $C4A0
    add  hl, bc
    ld   [hl], b
    ld   hl, $C410
    add  hl, bc
    ld   [hl], $0A

label_F3E6::
    ret

label_F3E7::
    dec  l
    ld   l, $38
    scf
    ld   hl, $C1AC
    ld   a, [$C13E]
    or   [hl]
    ld   hl, $FFB6
    or   [hl]
    ld hl, wIsUsingSpinAttack
    or   [hl]
    jp   nz, label_F4E1
    ld   a, [$C140]
    cp   $00
    jp   z, label_F4E1
    ld   hl, $C380
    add  hl, bc
    ldh  a, [$FF9E]
    cp   [hl]
    jp   z, label_F4E1
    ld   de, $FFEE
    ld   hl, $D5C0
    ld   a, [de]
    add  a, [hl]
    push hl
    ld   hl, $C140
    sub  a, [hl]
    cp   $80
    jr   c, label_F422
    cpl
    inc  a

label_F422::
    pop  hl
    push af
    inc  hl
    ld   a, [$C141]
    add  a, [hl]
    ld   e, a
    pop  af
    cp   e
    jp   nc, label_F4E1
    inc  hl
    ld   de, $FFEC
    ld   a, [de]
    add  a, [hl]
    push hl
    ld   hl, $C142
    sub  a, [hl]
    cp   $80
    jr   c, label_F440
    cpl
    inc  a

label_F440::
    pop  hl
    push af
    inc  hl
    ld   a, [$C143]
    add  a, [hl]
    ld   e, a
    pop  af
    cp   e
    jp   nc, label_F4E1
    call label_CB6
    ld   a, $08
    ld   [$C13E], a
    ld   a, $12
    call label_F565
    ld   a, $18
    call label_FE45
    ldh  a, [$FFD7]
    cpl
    inc  a
    ld   hl, $C400
    add  hl, bc
    ld   [hl], a
    ldh  a, [$FFD8]
    cpl
    inc  a
    ld   hl, $C3F0
    add  hl, bc
    ld   [hl], a
    call label_F3DB
    ld   [hl], $08
    xor  a
    ld   [$C122], a
    call label_C50
    ld hl, wIsUsingSpinAttack
    ld a, [wC16A]
    or   [hl]
    jr   z, label_F48B
    ld   a, $0C
    ld   [$C16D], a

label_F48B::
    ldh  a, [$FFEB]
    cp   $BE
    jr   nz, label_F4C1
    ld   a, $09
    ldh  [$FFF2], a
    ld   a, [$D205]
    cp   $00
    jr   z, label_F4BF
    cp   $01
    jr   z, label_F4B5
    cp   $04
    jr   z, label_F4B5
    cp   $03
    jp   z, label_F571
    ld   a, $20
    ld   [$C13E], a
    ld   a, $20
    call label_F565
    jr   label_F4DC

label_F4B5::
    ld   a, $10
    ld   [$C13E], a
    ld   a, $20
    call label_F565

label_F4BF::
    jr   label_F4DC

label_F4C1::
    ldh  a, [$FF9E]
    ld   e, a
    ld   d, b
    ld   hl, data_F4E4
    add  hl, de
    ld   a, [$C140]
    add  a, [hl]
    ldh  [$FFD7], a
    ld   hl, data_F4E8
    add  hl, de
    ld   a, [$C142]
    add  a, [hl]
    ldh  [$FFD8], a
    call label_D15

label_F4DC::
    ld   a, $0C
    ldh  [$FFB6], a
    ret

label_F4E1::
    jp   label_F4EC

data_F4E4::
    db 0, $F0, $F8, $FC

data_F4E8::
    db $FC, $FC, $F0, 0

label_F4EC::
    ldh a, [hFrameCounter]
    xor  c
    rra
    jr   nc, label_F570

    ldh a, [hLinkPositionX]
    add $08
    ldh [$d7], a
    ldh a, [hLinkPositionY]
    add $08
    ldh [$d9], a
    ld de, $ffee
    ld hl, $d5c0
    ld   a, [de]
    add  a, [hl]
    push hl
    ld   hl, $FFD7
    sub  a, [hl]
    cp   $80
    jr   c, label_F511
    cpl
    inc  a

label_F511::
    pop  hl
    push af
    inc  hl
    ld   a, $04
    add  a, [hl]
    ld   e, a
    pop  af
    cp   e
    jr   nc, label_F570
    inc  hl
    ld   de, $FFEC
    ld   a, [de]
    add  a, [hl]
    push hl
    ld   hl, $FFD9
    sub  a, [hl]
    cp   $80
    jr   c, label_F52D
    cpl
    inc  a

label_F52D::
    pop  hl
    push af
    inc  hl
    ld   a, $05
    add  a, [hl]
    ld   e, a
    pop  af
    cp   e
    jr   nc, label_F570
    ld   a, [$DBC7]
    and  a
    jr   nz, label_F570
    call label_ECD5
    ldh  a, [$FFEB]
    cp   $BE
    jr   nz, label_F570
    ld   a, [$D205]
    and  a
    jr   z, label_F570
    cp   $01
    jr   z, label_F570
    cp   $04
    jr   z, label_F570
    cp   $02
    jr   nz, label_F571
    call label_C00
    ld   [hl], $A0
    ld   a, $20
    ld   [$C13E], a
    ld   a, $30

label_F565::
    call label_FE45
    ldh  a, [$FFD7]
    ldh  [$FF9B], a
    ldh  a, [$FFD8]
    ldh  [$FF9A], a

label_F570::
    ret

label_F571::
    ld   hl, $C3D0
    add  hl, bc
    ld   a, [hl]
    cp   $22
    jr   c, label_F570
    ld   a, $0A
    ld   [wLinkMotionState], a
    ld   hl, $C380
    add  hl, bc
    ld   a, [hl]
    and  a
    ld   a, $30
    jr   z, label_F58B
    ld   a, $D0

label_F58B::
    ldh  [$FF9A], a
    xor  a
    ldh  [$FF9B], a
    ld   a, $30
    ldh  [$FFA3], a
    ld   a, $0B
    ldh  [$FFF2], a
    ret
    ld   a, $20
    ld   [$C13E], a
    ld   a, $20
    jr   label_F565

label_F5A2::
    ld   e, $0F
    ld   d, $00

label_F5A6::
    ld   a, e
    cp   c
    jp   z, label_F79F

    ldh a, [hFrameCounter]
    xor  e
    and  $01
    jp   nz, label_F79F

    ld hl, wEntitiesTypeTable
    add  hl, de
    ld   a, [hl]
    cp   $05
    jp  c, label_F79F
    ld   hl, $C340
    add  hl, de
    ld   a, [hl]
    and  $40
    jp   nz, label_F79F

    ld hl, wEntity0PosX
    add  hl, de
    ldh  a, [$FFEE]
    sub  a, [hl]
    add  a, $0C
    cp   $18
    jp   nc, label_F79F

    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   a, [hl]
    ld   hl, $C310
    add  hl, de
    sub  a, [hl]
    ld   hl, $FFEC
    sub  a, [hl]
    add  a, $0C
    cp   $18
    jp   nc, label_F79F
    ld   hl, $C3B0
    add  hl, de
    ld   a, [hl]
    cp   $FF
    jp   z, label_F79F
    ldh  a, [$FFEB]
    cp   $55
    jr   nz, label_F5FE
    call IsEntityFrameCounterZero
    ld   [hl], b

label_F5FE::
    ld   hl, $C3A0
    add  hl, de
    ld   a, [hl]
    cp   $55
    jr   nz, label_F630
    ld   hl, $C240
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C240
    add  hl, de
    ld   [hl], a
    ld   hl, $C250
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C250
    add  hl, de
    ld   [hl], a
    ld hl, wEntitiesFrameCounterTable
    add  hl, de
    ld   [hl], $40
    ld hl, wEntitiesWalkingTable
    add  hl, de
    ld   [hl], $02
    ld hl, wEntitiesUnknowTableF
    add  hl, de
    ld   [hl], $08
    jp   label_F79F

label_F630::
    ld   hl, $C340
    add  hl, de
    ld   a, [hl]
    and  $20
    jp   nz, label_F715
    ldh  a, [$FFEB]
    cp   $08
    jr   z, label_F668
    ld   hl, $C3A0
    add  hl, de
    ld   a, [hl]
    cp   $E6
    jr   nz, label_F656
    ld   a, [$D219]
    cp   $05
    jr   nz, label_F656
    ldh  a, [$FFF1]
    cp   $02
    jr   nz, label_F65F

label_F656::
    ld   hl, $C350
    add  hl, de
    ld   a, [hl]
    and  $80
    jr   z, label_F668

label_F65F::
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   [hl], $01
    jp   label_F737

label_F668::
    ldh  a, [$FFEB]
    cp   $08
    jr   nz, label_F6AC
    ld   hl, $C3A0
    add  hl, de
    ld   a, [hl]
    cp   $CA
    jr   nz, label_F680

    ld hl, wEntitiesWalkingTable
    add  hl, de
    ld   a, [hl]
    and  a
    jr   nz, label_F6AC
    inc  [hl]

label_F680::
    cp   $3F
    jr   nz, label_F6AC

    ld a, [wActiveRoom]
    and  a
    jr   nz, label_F6AC

    ld hl, wEntitiesWalkingTable
    add  hl, de
    ld   a, [hl]
    and  a
    jr   nz, label_F6AC
    inc  [hl]
    ld   hl, $C450
    add  hl, de
    ld   [hl], $7F
    ld   hl, $C420
    add  hl, de
    ld   [hl], $10
    ld   a, $03
    ld [wCurrentBank], a
    call label_27F2
    ld   a, $18
    ld [wCurrentBank], a

label_F6AC::
    ld   hl, $C350
    add  hl, de
    ld   a, [hl]
    and  $80
    jp   nz, label_F79F
    ld   hl, $C410
    add  hl, de
    ld   a, [hl]
    and  a
    jp   nz, label_F79F
    ld   hl, $C3A0
    add  hl, de
    ld   a, [hl]
    cp   $24
    jr   nz, label_F710
    ld   hl, $C380
    add  hl, de
    ld   a, [hl]
    xor  $01
    ld   hl, $C380
    add  hl, bc
    cp   [hl]
    jr   nz, label_F710

    ld hl, wEntitiesUnknownTableC
    add  hl, de
    ld   a, [hl]
    and  a
    jr   nz, label_F710
    ldh  a, [$FFEB]
    cp   $03
    jp   nz, label_F65F
    ld   [hl], $01
    push de
    ld   a, $32
    call label_E4CA
    jr   c, label_F70D

    ldh a, [$d7]
    ld hl, wEntity0PosX
    add  hl, de
    ld   [hl], a
    ldh a, [$d8]
    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   [hl], a
    ld   hl, $C390
    add  hl, de
    ld   a, c
    inc  a
    ld   [hl], a
    ldh  a, [$FFD9]
    and  $01
    ld   hl, $C3B0
    add  hl, de
    ld   [hl], a

label_F70D::
    pop  de
    jr   label_F737

label_F710::
    call label_F7A7
    jr   label_F737

label_F715::
    ldh  a, [$FFEB]
    cp   $01
    jr   z, label_F71F
    cp   $03
    jr   nz, label_F734

label_F71F::
    call IsEntityFrameCounterZero
    xor  a
    ld   [hl], a
    ld   hl, $C340
    add  hl, de
    ld   a, [hl]
    and  $20
    jr   z, label_F737
    ld   a, c
    inc  a
    ld   hl, $C390
    add  hl, de
    ld   [hl], a

label_F734::
    jp   label_F79F

label_F737::
    ldh  a, [$FFEB]
    cp   $A8
    jr   z, label_F75A
    cp   $01
    jr   z, label_F79A
    cp   $03
    jr   z, label_F79A
    cp   $05
    jr   nz, label_F751
    push de
    call label_D3E4
    pop  de
    jp   label_F79F

label_F751::
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   a, [hl]
    cp   $08
    jr   nz, label_F782

label_F75A::
    ld   hl, $C480
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   nz, label_F79F
    ld   [hl], $0C
    ld   hl, $C240
    add  hl, bc
    sra  [hl]
    sra  [hl]
    ld   a, [hl]
    cpl
    ld   [hl], a
    ld   hl, $C250
    add  hl, bc
    sra  [hl]
    sra  [hl]
    ld   a, [hl]
    cpl
    ld   [hl], a
    ld   hl, $C5D0
    add  hl, bc
    ld   [hl], $FF
    jr   label_F79A

label_F782::
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   nz, label_F79A
    ldh  a, [$FFEB]
    cp   $00
    jr   nz, label_F795
    ldh  a, [$FFF0]
    and  a
    jr   nz, label_F798

label_F795::
    call label_3F8D

label_F798::
    jr   label_F79F

label_F79A::
    call IsEntityFrameCounterZero
    xor  a
    ld   [hl], a

label_F79F::
    dec  e
    ld   a, e
    cp   $FF
    jp   nz, label_F5A6
    ret

label_F7A7::
    ldh  a, [$FFEB]
    cp   $00
    jr   nz, label_F7B8
    ldh  a, [$FFF0]
    and  a
    jr   z, label_F7B8
    call IsEntityFrameCounterZero
    ld   [hl], $03
    ret

label_F7B8::
    ld   hl, $C240
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C3F0
    add  hl, de
    ld   [hl], a
    ld   hl, $C250
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C400
    add  hl, de
    ld   [hl], a
    push bc
    ld   c, e
    ld   b, d
    push de
    call label_F7D6
    pop  de
    pop  bc
    ret

label_F7D6::
    jp   label_F1C0

label_F7D9::
    ld   e, $0F
    ld   d, $00

label_F7DD::
    ld hl, wEntitiesTypeTable
    add  hl, de
    ld   a, [hl]
    cp   $05
    jr   c, label_F834
    ld   hl, $C340
    add  hl, de
    ld   a, [hl]
    and  $60
    jr   nz, label_F834
    ld   hl, $C350
    add  hl, de
    ld   a, [hl]
    and  $80
    jr   nz, label_F834

    ld hl, wEntity0PosX
    add  hl, de
    ldh  a, [$FFEE]
    sub  a, [hl]
    add  a, $18
    cp   $30
    jr   nc, label_F834

    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   a, [hl]
    ld   hl, $C310
    add  hl, de
    sub  a, [hl]
    ld   hl, $FFEC
    sub  a, [hl]
    add  a, $18
    cp   $30
    jr   nc, label_F834
    ld   a, $07
    ld   [$C19E], a
    call label_F7A7
    ld   a, $30
    call label_F83B
    ld   hl, $C400
    add  hl, de
    ldh  a, [$FFD7]
    ld   [hl], a
    ld   hl, $C3F0
    add  hl, de
    ldh  a, [$FFD8]
    ld   [hl], a

label_F834::
    dec  e
    ld   a, e
    cp   $FF
    jr   nz, label_F7DD
    ret

label_F83B::
    ldh [$d7], a
    ldh a, [hLinkPositionX]
    push af
    ld hl, wEntity0PosX
    add  hl, de
    ld   a, [hl]
    ldh [hLinkPositionX], a
    ldh a, [hLinkPositionY]
    push af
    ld hl, wEntitiesPosYTable
    add  hl, de
    ld   a, [hl]
    ldh [hLinkPositionY], a
    push de
    ldh  a, [$FFD7]
    call label_FE45
    pop  de
    pop  af
    ldh [hLinkPositionY], a
    pop  af
    ldh [hLinkPositionX], a
    ret

data_F85F::
    db $D, 2, 8, 8, $A, 6, 8, 8, $10, $FF, 8, 8, $D, 2, 8, 8

data_F86F::
    db 8, 8, 2, $D, 8, 8, 6, $A, 8, 8, $FF, $10, 8, 8, 2, $D

data_F87F::
    db 1, 2, 4, 8

data_F883::
    db 0, 0, $FF, 1, 1, $FF, 1, $FF

data_F88B::
    db 1, $FF, 0, 0, 1, 1, $FF, $FF

label_F893::
    ld   hl, $C470
    add  hl, bc
    ld   a, [hl]
    ldh  [$FFD7], a
    xor  a
    ld   [hl], a
    ldh  [$FFD8], a
    ld   [$C503], a
    ld   [$C50D], a
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    bit  7, a
    jr   nz, label_F8B1
    and  a
    jp   nz, label_FA18

label_F8B1::
    ld   hl, $C4F0
    add  hl, bc
    ld   [hl], b
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    bit  4, a
    jp   nz, label_FA18
    call label_FE0E
    jr   label_F8E3

label_F8C5::
    ld   e, $02
    ldh  a, [$FFEB]
    cp   $CC
    jr   z, label_F907
    cp   $A0
    jr   z, label_F907
    cp   $D5
    jr   z, label_F907
    cp   $6D
    jr   z, label_F907
    cp   $C1
    jr   z, label_F907
    call label_3F8D
    jp   label_F95C

label_F8E3::
    ld   e, $01
    ldh  a, [$FFAF]
    cp   $67
    jr   z, label_F907
    ldh  a, [$FFDA]
    and  a
    jp   z, label_FA18
    cp   $0B
    jr   z, label_F8C5
    cp   $07
    jr   z, label_F8C5
    cp   $B0
    jr   z, label_F907
    inc  e
    cp   $05
    jr   z, label_F907
    cp   $06
    jr   nz, label_F90C
    inc  e

label_F907::
    ld   hl, $C470
    add  hl, bc
    ld   [hl], e

label_F90C::
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    and  $08
    jr   z, label_F973
    ld   hl, $C470
    add  hl, bc
    ldh  a, [$FFD7]
    cp   [hl]
    jr   z, label_F973
    ld   a, [hl]
    cp   $03
    jr   z, label_F973
    ldh  a, [$FFD7]
    cp   $03
    jr   z, label_F973
    ldh  a, [$FFF9]
    and  a
    jr   nz, label_F93D
    ld   hl, $C320
    add  hl, bc
    ld   a, [hl]
    bit  7, a
    jr   z, label_F973
    cp   $E7
    jr   nc, label_F973
    jr   label_F954

label_F93D::
    ldh  a, [$FFEB]
    cp   $AC
    jr   z, label_F954
    ld   hl, $C250
    add  hl, bc
    ld   a, [hl]
    bit  7, a
    jr   nz, label_F954
    ld   [hl], $00
    ld   hl, $C240
    add  hl, bc
    sra  [hl]

label_F954::
    ld   hl, $C480
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   nz, label_F973

label_F95C::
    ld hl, wEntity0PosX
    add  hl, bc
    ld   a, [hl]
    ldh [$d7], a
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    ldh  [$FFD8], a
    ld   a, $0E
    ldh  [$FFF2], a
    ld   a, $01
    call label_CC7

label_F973::
    ldh  a, [$FFDA]
    inc  a
    cp   $F1
    jr   c, label_F99C
    sub  a, $F1
    ld   e, a
    ld   d, b
    ldh a, [hFrameCounter]
    and  $03
    jr   nz, label_F99A
    ld   hl, data_F883
    add  hl, de
    ld   a, [hl]
    ld hl, wEntity0PosX
    add  hl, bc
    add  a, [hl]
    ld   [hl], a
    ld   hl, data_F88B
    add  hl, de
    ld   a, [hl]
    ld hl, wEntitiesPosYTable
    add  hl, bc
    add  a, [hl]
    ld   [hl], a

label_F99A::
    jr   label_FA18

label_F99C::
    ldh  a, [$FFAF]
    cp   $61
    jr   z, label_F9AC
    ldh  a, [$FFDA]
    cp   $50
    jr   z, label_F9AC
    cp   $51
    jr   nz, label_FA18

label_F9AC::
    ldh  a, [$FFEB]
    cp   $6D
    jr   z, label_FA18
    cp   $D5
    jr   z, label_FA18
    cp   $36
    jr   z, label_FA18
    cp   $C1
    jr   nz, label_F9CB
    ld   a, [wLinkMotionState]
    cp   $06
    jr   nz, label_FA18
    ldh  a, [$FFAF]
    cp   $61
    jr   nz, label_FA18

label_F9CB::
    ld   hl, $C410
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_FA18
    dec  [hl]
    ld   hl, $C420
    add  hl, bc
    ld   [hl], $00
    ld hl, wEntitiesTypeTable
    add  hl, bc
    ld   [hl], $02
    ldh  a, [$FFCE]
    add  a, $08
    ld   hl, $C4B0
    add  hl, bc
    ld   [hl], a
    ldh  a, [$FFCD]
    add  a, $10
    ld   hl, $C4C0
    add  hl, bc
    ld   [hl], a
    call IsEntityFrameCounterZero
    ld   [hl], $6F
    ldh  a, [$FFEB]
    cp   $14
    jr   z, label_FA18
    cp   $0B
    jr   z, label_FA18
    cp   $09
    jr   z, label_FA18
    ld   [hl], $48
    ld   hl, $C410
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   nz, label_FA18
    call IsEntityFrameCounterZero
    ld   [hl], $2F
    ld   a, $18
    ldh  [$FFF2], a

label_FA18::
    ldh  a, [$FFEB]
    cp   $6D
    jp   z, label_FA84
    xor  a
    ld   [$C503], a
    ld   hl, $C350
    add  hl, bc
    ld   a, [hl]
    and  $03
    sla  a
    sla  a
    ldh [$d7], a
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    xor  a
    ld   [hl], a
    ld   hl, $C240
    add  hl, bc
    ld   a, [hl]
    cp   $00
    jr   z, label_FA5D
    ld   de, $0000
    and  $80
    jr   z, label_FA47
    inc  e

label_FA47::
    call label_FACD
    jr   c, label_FA5D
    ldh  a, [$FFAF]
    ld   [$C503], a
    ldh  a, [$FFBE]
    and  a
    jr   nz, label_FA5D

    ld hl, wEntity0PosX
    add  hl, bc
    ldh  a, [$FFEE]
    ld   [hl], a

label_FA5D::
    ld   hl, $C250
    add  hl, bc
    ld   a, [hl]
    cp   $00
    jr   z, label_FA84
    ld   de, $0002
    and  $80
    jr   nz, label_FA6E
    inc  e

label_FA6E::
    call label_FACD
    jr   c, label_FA84
    ldh  a, [$FFAF]
    ld   [$C50D], a
    ldh  a, [$FFBE]
    and  a
    jr   nz, label_FA84

    ld hl, wEntitiesPosYTable
    add  hl, bc
    ldh  a, [$FFEF]
    ld   [hl], a

label_FA84::
    ret

data_FA85::
    db 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1
    db 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1
    db 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0
    db 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1
    db 0, 1, 1, 0, 1, 0, 0, 1

label_FACD::
    push bc
    ld   hl, $C200
    add  hl, bc
    ld   a, [hl]
    sub  a, $08
    push af
    ldh  a, [$FFD7]
    ld   c, a
    pop  af
    ld   hl, data_F85F
    add  hl, bc
    add  hl, de
    add  a, [hl]
    ldh  [$FFDB], a
    swap a
    and  $0F
    ldh  [$FFD8], a
    pop  bc
    push bc
    ld   a, e
    cp   $03
    jr   nz, label_FB0E
    ldh  a, [$FFEB]
    cp   $A8
    jr   z, label_FAF9
    cp   $05
    jr   nz, label_FB0E

label_FAF9::
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C310
    add  hl, bc
    ld   c, [hl]
    bit  7, c
    jr   z, label_FB09
    ld   c, $00

label_FB09::
    srl  c
    sub  a, c
    jr   label_FB13

label_FB0E::
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   a, [hl]

label_FB13::
    sub  a, $10
    push af
    ldh  a, [$FFD7]
    ld   c, a
    pop  af
    ld   hl, data_F86F
    add  hl, bc
    add  hl, de
    add  a, [hl]
    ldh  [$FFDC], a
    and  $F0
    ld   hl, $FFD8
    or   [hl]
    ld   c, a
    ld hl, wTileMap
    ld   a, h
    add  hl, bc
    ld   h, a
    pop  bc
    ld   a, [hl]
    ldh  [$FFAF], a
    cp   $20
    jp   z, label_FC7B
    push de
    ld   e, a
    ld a, [wActiveRoom]
    ld   d, a
    call label_2A2C
    pop  de
    ldh  [$FFDA], a
    ldh  a, [$FFEB]
    cp   $CC
    jr   z, label_FB4E
    cp   $99
    jr   nz, label_FB5D

label_FB4E::
    ldh  a, [$FFDA]
    cp   $05
    jp   z, label_FCA7
    cp   $07
    jp   z, label_FCA7
    jp   label_FC75

label_FB5D::
    ldh  a, [$FFDA]
    and  a
    jp   z, label_FCA7
    cp   $0B
    jr   z, label_FB6F
    cp   $50
    jr   z, label_FB6F
    cp   $51
    jr   nz, label_FB8B

label_FB6F::
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    and  a
    jp   nz, label_FCA7
    ld   hl, $C410
    add  hl, bc
    ld   a, [hl]
    and  a
    jp   z, label_FC75
    ldh  a, [$FFEB]
    cp   $59
    jp   z, label_FC75
    jp   label_FCA7

label_FB8B::
    cp   $7C
    jp  c, label_FBE4
    cp   $90
    jp   nc, label_FBE4
    cp   $80
    ldh  a, [$FFEB]
    jr   c, label_FBA7
    cp   $A8
    jp   z, label_FCA7
    cp   $02
    jp   z, label_FCA7
    jr   label_FBBB

label_FBA7::
    cp   $16
    jp   z, label_FC9A
    cp   $17
    jp   z, label_FC9A
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    and  $80
    jp   nz, label_FC9A

label_FBBB::
    push de
    ldh  a, [$FFDA]
    sub  a, $7C
    sla  a
    sla  a
    ld   e, a
    ld   d, $00
    ld   hl, data_FA85
    add  hl, de
    ldh  a, [$FFDB]
    rra
    rra
    rra
    and  $01
    ld   e, a
    ldh  a, [$FFDC]
    rra
    rra
    and  $02
    or   e
    ld   e, a
    ld   d, $00
    add  hl, de
    ld   a, [hl]
    pop  de
    and  a
    jp   z, label_FCA7

label_FBE4::
    ldh  a, [$FFDA]
    cp   $D0
    jr   c, label_FC2B
    cp   $D4
    jr   nc, label_FC2B
    sub  a, $D0
    ld   hl, $C5D0
    add  hl, bc
    cp   [hl]
    jr   z, label_FC1A
    ldh  a, [$FFEB]
    cp   $A8
    jr   z, label_FC75
    ld   hl, $C4F0
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_FC75

    ldh a, [hFrameCounter]
    and  $03
    jr   z, label_FC28

    ld a, [wActiveRoom]
    and  a
    jr   nz, label_FC17

    ldh a, [hFrameCounter]
    and  $01
    jr   z, label_FC28

label_FC17::
    dec  [hl]
    jr   label_FC28

label_FC1A::
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    and  a
    jp   z, label_FC75
    ld   hl, $C4F0
    add  hl, bc
    inc  [hl]

label_FC28::
    jp   label_FCA7

label_FC2B::
    cp   $FF
    jr   z, label_FC9A
    cp   $A0
    jr   nc, label_FCA7
    cp   $10
    jr   nc, label_FC75
    cp   $01
    jr   z, label_FC91
    cp   $03
    jr   z, label_FC91
    cp   $04
    jr   nz, label_FCA7
    ldh  a, [$FFEB]
    cp   $A8
    jp   z, label_FCA7
    cp   $02
    jp   z, label_FCA7
    cp   $03
    jr   nz, label_FC5A
    ld   a, [$D6F9]
    and  a
    jp   nz, label_FCA7

label_FC5A::
    ldh  a, [$FFAF]
    cp   $DB
    jr   c, label_FC9A
    cp   $DD
    jr   nc, label_FC9A
    push de
    sub  a, $DB
    ld   e, a
    ld   d, $00
    ld   hl, data_FCA9
    add  hl, de
    pop  de
    ld   a, [$D6FB]
    xor  [hl]
    jr   z, label_FCA7

label_FC75::
    ldh  a, [$FFDA]
    cp   $60
    jr   nz, label_FC91

label_FC7B::
    ldh  a, [$FFEB]
    cp   $03
    jr   nz, label_FC91
    call IsEntityFrameCounterZero
    cp   $26
    jr   c, label_FC8B
    call label_3F8D

label_FC8B::
    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   [hl], $01

label_FC91::
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    and  $01
    jr   nz, label_FCA7

label_FC9A::
    ld   hl, data_F87F
    add  hl, de
    ld   a, [hl]
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    or   [hl]
    ld   [hl], a
    and  a
    ret

label_FCA7::
    scf
    ret

data_FCA9::
    db 0, 2

label_FCAB::
    ld   de, $0000
    push bc
    ld hl, wEntity0PosX
    add  hl, bc
    ld   a, [hl]
    ldh  [$FFDB], a
    and  $F0
    ldh  [$FFCE], a
    swap a
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   c, a
    ld   a, [hl]
    sub  a, $08
    ldh  [$FFDC], a
    and  $F0
    ldh  [$FFCD], a
    or   c
    ld   c, a
    ldh  [$FFE9], a
    ld   b, $00
    ld hl, wTileMap
    ld   a, h
    add  hl, bc
    ld   h, a
    pop  bc
    ld   a, [hl]
    ldh  [$FFAF], a
    cp   $AC
    jp   z, label_FE03
    cp   $AB
    jp   nz, label_FD6B

    ldh a, [hIsGBC]
    and  a
    jr   z, label_FCFD
    ld   a, [wLinkMotionState]
    cp   $05
    ret  z
    ld   a, [$DDD6]
    and  a
    jp   nz, label_FE03

    ld a, [wMapSlideTransitionState]
    and  a
    jp   nz, label_FE03

label_FCFD::
    ldh  a, [$FFEB]
    cp   $04
    jr   nz, label_FD6B

    ld a, [wActiveRoom]
    and  a
    jr   z, label_FD6B
    push hl
    ld   a, $12
    ldh  [$FFF4], a
    ld   a, $08
    call label_E4CA
    jr   c, label_FD6A
    pop  hl
    ld   a, $AC
    ld   [hl], a
    ld   [$DDD8], a
    push bc
    ld   c, e
    ld   b, d
    ld   d, h
    ld   e, l
    ld hl, wEntitiesUnknownTableB
    add  hl, bc
    ld   [hl], d
    ld hl, wEntitiesUnknownTableC
    add  hl, bc
    ld   [hl], e
    ldh a, [$ce]
    ld hl, wEntity0PosX
    add  hl, bc
    ld   [hl], a
    ldh a, [$cd]
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   [hl], a
    ld hl, wEntitiesWalkingTable
    add  hl, bc
    ld   [hl], $01
    call label_BFB
    ld   [hl], $80
    pop  bc
    ld   hl, $C1A2
    inc  [hl]
    ld   a, [$C3CD]
    and  a
    jr   z, label_FD63
    sub  a, $04
    ld   [$C3CD], a
    ldh a, [hIsGBC]
    and  a
    jr   z, label_FD63
    ld   a, $40
    ld   [$DDD6], a
    ld   a, $0B
    ld   [$DDD7], a

label_FD63::
    ld   de, data_E9A2
    push de
    jp   label_D1F5

label_FD6A::
    pop  hl

label_FD6B::
    ld   a, [hl]
    ld   e, a
    ld a, [wActiveRoom]
    ld   d, a
    call label_2A2C
    ldh  [$FFD8], a
    and  a
    jp   z, label_FE03
    ldh  [$FFDA], a
    cp   $FF
    jp   z, label_FE05
    cp   $D0
    jr   c, label_FDC0
    cp   $D4
    jr   nc, label_FDC0
    sub  a, $D0
    ld   hl, $C5D0
    add  hl, bc
    cp   [hl]
    jr   z, label_FDB0
    ld   hl, $C4F0
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_FDE3

    ldh a, [hFrameCounter]
    and  $03
    jr   z, label_FE03

    ld a, [wActiveRoom]
    and  a
    jr   nz, label_FDAC

    ldh a, [hFrameCounter]
    and  $01
    jr   z, label_FE03

label_FDAC::
    dec  [hl]
    jp   label_FE03

label_FDB0::
    ld   hl, $C310
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_FDE3
    ld   hl, $C4F0
    add  hl, bc
    inc  [hl]
    jp   label_FE03

label_FDC0::
    cp   $7C
    jp  c, label_FDCD
    cp   $90
    jp   nc, label_FDCD
    jp   label_FE03

label_FDCD::
    ldh  a, [$FFDA]
    cp   $A0
    jr   nc, label_FE03
    cp   $50
    jr   z, label_FE03
    cp   $51
    jr   z, label_FE03
    cp   $10
    jr   nc, label_FDE3
    cp   $01
    jr   nz, label_FE03

label_FDE3::
    ld hl, wEntitiesUnknownTableA
    add  hl, bc
    ld   [hl], $01
    ldh  a, [$FFEB]
    cp   $01
    jr   nz, label_FDF3
    call IsEntityFrameCounterZero
    ret  z

label_FDF3::
    ld hl, wEntity0PosX
    add  hl, bc
    ldh  a, [$FFEE]
    ld   [hl], a
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ldh  a, [$FFEF]
    ld   [hl], a
    scf
    ret

label_FE03::
    and  a
    ret

label_FE05::
    ldh  a, [$FFEB]
    cp   $01

label_FE09::
    jr   z, label_FDE3
    jp   label_3F8D

label_FE0E::
    push bc
    ld hl, wEntity0PosX
    add  hl, bc
    ld   a, [hl]
    sub  a, $01
    ldh  [$FFDB], a
    and  $F0
    ldh  [$FFCE], a
    swap a
    ld hl, wEntitiesPosYTable
    add  hl, bc
    ld   c, a
    ld   a, [hl]
    sub  a, $07
    ldh  [$FFDC], a
    and  $F0
    ldh  [$FFCD], a
    or   c
    ld   c, a
    ld   b, $00
    ld hl, wTileMap
    ld   a, h
    add  hl, bc
    ld   h, a
    pop  bc
    ld   a, [hl]
    ldh  [$FFAF], a
    ld   e, a
    ld a, [wActiveRoom]
    ld   d, a
    call label_2A2C
    ldh  [$FFDA], a
    ret

label_FE45::
    ldh  [$FFD8], a
    and  a
    jp   z, label_FEC3
    call label_FEE9
    dec  e
    dec  e
    ld   a, e
    ldh  [$FFD9], a
    ld   a, d
    bit  7, a
    jr   z, label_FE5A
    cpl
    inc  a

label_FE5A::
    ldh  [$FFE3], a
    call label_FED9
    ld   a, e
    ldh  [$FFDA], a
    ld   a, d
    bit  7, a
    jr   z, label_FE69
    cpl
    inc  a

label_FE69::
    ldh  [$FFE4], a
    ld   e, $00
    ld   hl, $FFE3
    ldh  a, [$FFE4]
    cp   [hl]
    jr   nc, label_FE7E
    inc  e
    push af
    ldh  a, [$FFE3]
    ldh  [$FFE4], a
    pop  af
    ldh  [$FFE3], a

label_FE7E::
    xor  a
    ldh  [$FFE2], a
    ldh  [$FFD7], a
    ldh  a, [$FFD8]
    ld   d, a

label_FE86::
    ldh  a, [$FFE2]
    ld   hl, $FFE3
    add  a, [hl]
    jr   c, label_FE94
    ld   hl, $FFE4
    cp   [hl]
    jr   c, label_FE99

label_FE94::
    sub  a, [hl]
    ld   hl, $FFD7
    inc  [hl]

label_FE99::
    ldh  [$FFE2], a
    dec  d
    jr   nz, label_FE86
    ld   a, e
    and  a
    jr   z, label_FEAC
    ldh  a, [$FFD7]
    push af
    ldh  a, [$FFD8]
    ldh  [$FFD7], a
    pop  af
    ldh  [$FFD8], a

label_FEAC::
    ldh  a, [$FFD9]
    and  a
    ldh  a, [$FFD7]
    jr   nz, label_FEB7
    cpl
    inc  a
    ldh  [$FFD7], a

label_FEB7::
    ldh  a, [$FFDA]
    and  a
    ldh  a, [$FFD8]
    jr   z, label_FEC2
    cpl
    inc  a
    ldh  [$FFD8], a

label_FEC2::
    ret

label_FEC3::
    xor  a
    ldh  [$FFD7], a
    ret

label_FEC7::
    call label_FE45
    ldh  a, [$FFD7]
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a
    ldh  a, [$FFD8]
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    ret

label_FED9::
    ld   e, $00
    ldh a, [hLinkPositionX]
    ld hl, wEntity0PosX
    add  hl, bc
    sub  a, [hl]
    bit  7, a
    jr   z, label_FEE7
    inc  e

label_FEE7::
    ld   d, a
    ret

label_FEE9::
    ld   e, $02
    ldh a, [hLinkPositionY]
    ld hl, wEntitiesPosYTable
    add  hl, bc
    sub  a, [hl]
    ld   hl, $C310
    add  hl, bc
    add  a, [hl]
    bit  7, a
    jr   nz, label_FEFC
    inc  e

label_FEFC::
    ld   d, a
    ret

label_FEFE::
    call label_FED9
    ld   a, e
    ldh  [$FFD7], a
    ld   a, d
    bit  7, a
    jr   z, label_FF0B
    cpl
    inc  a

label_FF0B::
    push af
    call label_FEE9
    ld   a, e
    ldh  [$FFD8], a
    ld   a, d
    bit  7, a
    jr   z, label_FF19
    cpl
    inc  a

label_FF19::
    pop  de
    cp   d
    jr   nc, label_FF21
    ldh  a, [$FFD7]
    jr   label_FF23

label_FF21::
    ldh  a, [$FFD8]

label_FF23::
    ld   e, a
    ret

label_FF25::
    call label_FF32
    push bc
    ld   a, c
    add  a, $10
    ld   c, a
    call label_FF32
    pop  bc
    ret

label_FF32::
    ld   hl, $C240
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_FF5D
    push af
    swap a
    and  $F0
    ld   hl, $C260
    add  hl, bc
    add  a, [hl]
    ld   [hl], a
    rl   d
    ld hl, wEntity0PosX

label_FF4A::
    add  hl, bc
    pop  af
    ld   e, $00
    bit  7, a
    jr   z, label_FF54
    ld   e, $F0

label_FF54::
    swap a
    and  $0F
    or   e
    rr   d
    adc  a, [hl]
    ld   [hl], a

label_FF5D::
    ret

label_FF5E::
    ld   hl, $C320
    add  hl, bc
    ld   a, [hl]
    and  a
    jr   z, label_FF5D
    push af
    swap a
    and  $F0
    ld   hl, $C330
    add  hl, bc
    add  a, [hl]
    ld   [hl], a
    rl   d
    ld   hl, $C310
    jr   label_FF4A

label_FF78::
    ldh  a, [$FFEA]
    cp   $05
    jr   nz, label_FFA7

label_FF7E::
    ld a, [wGameplayType]
    cp   $07
    jr   z, label_FFA7
    cp   $01
    jr   z, label_FF94
    cp   $0B
    jr   nz, label_FFA7

    ld a, [wTransitionSequenceCounter]
    cp   $04
    jr   nz, label_FFA7

label_FF94::
    ld a, [wDialogState]
    ld hl, $c1a8
    or   [hl]
    ld hl, wInventoryAppearing
    or   [hl]
    jr   nz, label_FFA7

    ld a, [wMapSlideTransitionState]
    and  a
    jr   z, label_FFA8

label_FFA7::
    pop  af

label_FFA8::
    ret

label_FFA9::
    ld   hl, $C410
    add  hl, bc
    ld   a, [hl]
    and  a
    ret  z
    dec  a
    ld   [hl], a
    call label_3E8E
    ld   hl, $C240
    add  hl, bc
    ld   a, [hl]
    push af
    ld   hl, $C250
    add  hl, bc
    ld   a, [hl]
    push af
    ld   hl, $C3F0
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C240
    add  hl, bc
    ld   [hl], a
    ld   hl, $C400
    add  hl, bc
    ld   a, [hl]
    ld   hl, $C250
    add  hl, bc
    ld   [hl], a
    call label_FF25
    ld   hl, $C430
    add  hl, bc
    ld   a, [hl]
    and  $20
    jr   nz, label_FFE4
    call label_F893

label_FFE4::
    ld   hl, $C250
    add  hl, bc
    pop  af
    ld   [hl], a
    ld   hl, $C240
    add  hl, bc
    pop  af
    ld   [hl], a
    pop  af
    call label_3EAF
    ret

